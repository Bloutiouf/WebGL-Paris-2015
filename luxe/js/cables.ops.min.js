Ops.Array=Ops.Array||{},Ops.Array.RandomArray=function(){var e=this;Op.apply(this,arguments),this.name="RandomArray",this.numValues=this.addInPort(new Port(this,"numValues",OP_PORT_TYPE_VALUE)),this.values=this.addOutPort(new Port(this,"values",OP_PORT_TYPE_ARRAY));var t=[];this.numValues.onValueChanged=function(){t.length=e.numValues.val;for(var r=0;r<t.length;r++)t[r]=Math.random();e.values.val=t},this.numValues.val=100},Ops.Array.RandomArray.prototype=new Op,Ops.Array.ArrayGetValue=function(){function e(){t.value.val=t.array.val[t.index.val]}var t=this;Op.apply(this,arguments),this.name="ArrayGetValue",this.array=this.addInPort(new Port(this,"array",OP_PORT_TYPE_ARRAY)),this.index=this.addInPort(new Port(this,"index",OP_PORT_TYPE_VALUE,{type:"int"})),this.value=this.addOutPort(new Port(this,"value",OP_PORT_TYPE_VALUE));this.index.onValueChanged=e,this.array.onValueChanged=e},Ops.Array.ArrayGetValue.prototype=new Op,Ops.WebAudio=Ops.WebAudio||{},Ops.WebAudio.Output=function(){var e=this;Op.apply(this,arguments),window.audioContext||(audioContext=new AudioContext),this.name="audioOutput",this.audioIn=this.addInPort(new Port(this,"audio in",OP_PORT_TYPE_OBJECT)),this.oldAudioIn=null,this.audioIn.onValueChanged=function(){e.audioIn.val&&(console.log(e.audioIn.val),null===e.audioIn.val?null!==e.oldAudioIn&&e.oldAudioIn.disconnect(audioContext.destination):e.audioIn.val.connect(audioContext.destination),e.oldAudioIn=e.audioIn.val)}},Ops.WebAudio.Output.prototype=new Op,Ops.WebAudio.AudioPlayer=function(){function e(){if((window.gui||!(CGL.getLoadingStatus()>=1))&&r.audio){r.patch.timer.isPlaying()&&r.audio.paused?r.audio.play():r.patch.timer.isPlaying()||r.audio.paused||r.audio.pause();var e=r.patch.timer.getTime();isFinite(e)||(e=0),r.audio.currentTime=e}}function t(){r.audio&&(r.patch.timer.isPlaying()?r.audio.play():r.audio.pause())}var r=this;Op.apply(this,arguments),this.name="AudioPlayer",this.file=this.addInPort(new Port(this,"file",OP_PORT_TYPE_VALUE,{display:"file",filter:"mp3"})),this.volume=this.addInPort(new Port(this,"volume",OP_PORT_TYPE_VALUE,{display:"range"})),this.volume.val=1,window.audioContext||(audioContext=new AudioContext),this.filter=audioContext.createGain(),r.audio=null,this.volume.onValueChanged=function(){r.filter.gain.value=r.volume.val},this.file.onValueChanged=function(){CGL.incrementLoadingAssets(),r.audio=new Audio,r.audio.src=r.file.val;var n=function(){console.log("audio loaded!"),CGL.decrementLoadingAssets(),r.audio.removeEventListener("canplaythrough",n,!1)};r.audio.addEventListener("canplaythrough",n,!1),r.media=audioContext.createMediaElementSource(r.audio),r.patch.timer.onPlayPause(t),r.patch.timer.onTimeChange(e),r.media.connect(r.filter),r.audioOut.val=r.filter},this.audioOut=this.addOutPort(new Port(this,"audio out",OP_PORT_TYPE_OBJECT))},Ops.WebAudio.AudioPlayer.prototype=new Op,Ops.WebAudio.Oscillator=function(){var e=this;Op.apply(this,arguments),window.audioContext||(audioContext=new AudioContext),this.oscillator=audioContext.createOscillator(),this.oscillator.start(0),this.oscillator.frequency.value=200,this.name="Oscillator",this.frequency=this.addInPort(new Port(this,"frequency",OP_PORT_TYPE_VALUE)),this.frequency.onValueChanged=function(){e.oscillator.frequency.value=e.frequency.val},this.audioOut=this.addOutPort(new Port(this,"audio out",OP_PORT_TYPE_OBJECT)),this.audioOut.val=this.oscillator},Ops.WebAudio.Oscillator.prototype=new Op,Ops.WebAudio.MicrophoneIn=function(){var e=this;Op.apply(this,arguments),this.microphone=null,this.name="microphone",this.userMediaAvailable=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,this.audioOut=this.addOutPort(new Port(this,"audio out",OP_PORT_TYPE_OBJECT)),this.userMediaAvailable&&(window.audioContext||(audioContext=new AudioContext),navigator.getUserMedia({audio:!0},function(t){e.microphone=audioContext.createMediaStreamSource(t),e.audioOut.val=e.microphone},function(e){console.log("No live audio input "+e)}))},Ops.WebAudio.MicrophoneIn.prototype=new Op,Ops.WebAudio.Analyser=function(){var e=this;Op.apply(this,arguments),window.audioContext||(audioContext=new AudioContext),this.name="Audio Analyser",this.audioIn=this.addInPort(new Port(this,"audio in",OP_PORT_TYPE_OBJECT)),this.refresh=this.addInPort(new Port(this,"refresh",OP_PORT_TYPE_FUNCTION)),this.audioOut=this.addOutPort(new Port(this,"audio out",OP_PORT_TYPE_OBJECT)),this.avgVolume=this.addOutPort(new Port(this,"average volume",OP_PORT_TYPE_VALUE)),this.fftOut=this.addOutPort(new Port(this,"fft",OP_PORT_TYPE_ARRAY)),this.oldAudioIn=null,this.analyser=audioContext.createAnalyser(),this.analyser.smoothingTimeConstant=.3,this.analyser.fftSize=256;var t=0,r=null;this.refresh.onTriggered=function(){var t=new Uint8Array(e.analyser.frequencyBinCount);e.analyser.getByteFrequencyData(t);for(var n,i=0,a=0;a<t.length;a++)i+=t[a];n=i/t.length,e.avgVolume.val=n,e.analyser.getByteFrequencyData(r),e.fftOut.val=r},this.audioIn.onValueChanged=function(){console.log(e.audioIn.val),null===e.audioIn.val?null!==e.oldAudioIn&&e.oldAudioIn.disconnect(e.analyser):e.audioIn.val.connect(e.analyser),e.oldAudioIn=e.audioIn.val,t=e.analyser.frequencyBinCount,r=new Uint8Array(t)},this.audioOut.val=this.analyser},Ops.WebAudio.Analyser.prototype=new Op,Ops.Devices=Ops.Devices||{},Ops.Devices.GamePad=function(){Op.apply(this,arguments),this.name="GamePad",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.numPads=this.addOutPort(new Port(this,"numPads")),this.axis1=this.addOutPort(new Port(this,"axis1")),this.axis2=this.addOutPort(new Port(this,"axis2")),this.axis3=this.addOutPort(new Port(this,"axis3")),this.axis4=this.addOutPort(new Port(this,"axis4")),this.button0=this.addOutPort(new Port(this,"button0")),this.button1=this.addOutPort(new Port(this,"button1")),this.button2=this.addOutPort(new Port(this,"button2")),this.button3=this.addOutPort(new Port(this,"button3")),this.button4=this.addOutPort(new Port(this,"button4"));{var e=this;Date.now()/1e3}this.exe.onTriggered=function(){var t=navigator.getGamepads(),r=0;for(var n in t)t[n].axes&&(e.axis1.val=t[n].axes[0],e.axis2.val=t[n].axes[1],e.axis3.val=t[n].axes[2],e.axis4.val=t[n].axes[3],e.button0.val=t[n].buttons[0].pressed,e.button0.val=t[n].buttons[1].pressed,e.button2.val=t[n].buttons[2].pressed,e.button3.val=t[n].buttons[3].pressed,e.button4.val=t[n].buttons[4].pressed,r++);e.numPads.val=r},this.exe.onTriggered()},Ops.Devices.GamePad.prototype=new Op,Ops.Devices.LeapMotion=function(){Op.apply(this,arguments);var e=this;this.name="LeapMotion",this.transX=this.addOutPort(new Port(this,"translationX")),this.transY=this.addOutPort(new Port(this,"translationY")),this.transZ=this.addOutPort(new Port(this,"translationZ")),this.finger0X=this.addOutPort(new Port(this,"finger0X")),this.finger0Y=this.addOutPort(new Port(this,"finger0Y")),this.finger0Z=this.addOutPort(new Port(this,"finger0Z")),Leap.loop(function(t){e.transX.val=t._translation[0],e.transY.val=t._translation[1],e.transZ.val=t._translation[2],t.fingers.length>0&&(e.finger0X.val=t.fingers[0].tipPosition[0],e.finger0Y.val=t.fingers[0].tipPosition[1],e.finger0Z.val=t.fingers[0].tipPosition[2])})},Ops.Devices.LeapMotion.prototype=new Op,Ops.Experimental=Ops.Experimental||{},Ops.Experimental.ImageStream=function(){function e(){var e=new EventSource(t.url.val);e.addEventListener("message",function(e){n.src=e.data})}Op.apply(this,arguments);var t=this;this.name="ImageStream",this.url=this.addInPort(new Port(this,"url")),this.url.val="http://localhost:5600/images",this.tex=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE));var r=new CGL.Texture;r.setSize(320,240),$("#glcanvas").append('<img id="imagestream">');var n=document.getElementById("imagestream");this.tex.val=r,n.onload=function(){r.image=n,r.initTexture(n),console.log("loaded")},setTimeout(e,500)},Ops.Experimental.ImageStream.prototype=new Op,Ops.Experimental.SaltedPerceptionMaterial=function(){Op.apply(this,arguments);var e=this;this.name="SaltedPerceptionMaterial",this.zBufferTex=this.addInPort(new Port(this,"zBufferTexture",OP_PORT_TYPE_TEXTURE)),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){cgl.setShader(n),e.zBufferTex.val&&(cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.zBufferTex.val.tex)),e.trigger.call(),cgl.setPreviousShader()};var t="".endl()+"attribute vec3 vPosition;".endl()+"attribute vec2 attrTexCoord;".endl()+"attribute vec3 attrVertNormal;".endl()+"precision highp float;".endl()+"uniform mat4 projMatrix;".endl()+"uniform mat4 mvMatrix;".endl()+"uniform float time;".endl()+"uniform float zscale;".endl()+"attribute vec3 Normal;".endl()+"varying  vec2 texcoord;".endl()+"varying vec3 norm;".endl()+"uniform sampler2D texDepth;".endl()+"void main(void)".endl()+"{".endl()+"   norm=attrVertNormal;".endl()+"   texcoord=attrTexCoord;".endl()+"   float offX=1.0/640.0;".endl()+"   float offY=1.0/480.0;".endl()+"   vec4 texCol= 0.2*texture2D(texDepth, vec2(1.0-texcoord.s,1.0-texcoord.t));".endl()+"   texCol+=0.2* texture2D(texDepth, vec2(1.0-texcoord.s+offX,1.0-texcoord.t+offY));".endl()+"   texCol+=0.2* texture2D(texDepth, vec2(1.0-texcoord.s-offX,1.0-texcoord.t-offY));".endl()+"   texCol+=0.2* texture2D(texDepth, vec2(1.0-texcoord.s+offX,1.0-texcoord.t-offY));".endl()+"   texCol+=0.2* texture2D(texDepth, vec2(1.0-texcoord.s-offX,1.0-texcoord.t+offY));".endl()+"   vec3 vertex=vPosition;".endl()+"   vertex.z+=zscale*(texCol.r*190.0+sin(texCol.r*8.0+time*2.0)*5.0+sin(vertex.y+texture2D(texDepth,texcoord).r*10.0));".endl()+"   texCol.b=0.0;".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vertex,1.0);".endl()+"}",r="".endl()+"precision highp float;".endl()+"uniform sampler2D texColor;".endl()+"uniform sampler2D texDepth;".endl()+"uniform float time;".endl()+"varying  vec2 texcoord;".endl()+"void main(){ ".endl()+"vec4 color=texture2D(texDepth, vec2(1.0-texcoord.s,1.0-texcoord.t));".endl()+"color.a=1.0;".endl()+"//float d= texture2D(texDepth, vec2(1.0-texcoord.s,texcoord.t)).r;".endl()+"//if(d==1.0)color=vec4(0.0,0.0,0.0,0.0);".endl()+"gl_FragColor = color;".endl()+"}",n=new CGL.Shader;n.setSource(t,r),this.zBufferTexUniform=null,this.zBufferTex.onValueChanged=function(){if(e.zBufferTex.val){if(null!==e.zBufferTexUniform)return;console.log("TEXTURE ADDED"),n.removeUniform("texDepth"),n.define("HAS_TEXTURE_DIFFUSE"),e.zBufferTexUniform=new CGL.Uniform(n,"t","texDepth",0)}else console.log("TEXTURE REMOVED"),n.removeUniform("texDepth"),n.removeDefine("HAS_TEXTURE_DIFFUSE"),e.zBufferTexUniform=null},this.zScale=this.addInPort(new Port(this,"zscale",OP_PORT_TYPE_VALUE)),this.zScale.onValueChanged=function(){e.zScale.uniform?e.zScale.uniform.setValue(e.zScale.val):e.zScale.uniform=new CGL.Uniform(n,"f","zscale",e.zScale.val)},this.time=this.addInPort(new Port(this,"time",OP_PORT_TYPE_VALUE)),this.time.onValueChanged=function(){e.time.uniform?e.time.uniform.setValue(e.time.val):e.time.uniform=new CGL.Uniform(n,"f","time",e.time.val)},this.zScale.val=1,this.render.onTriggered=this.doRender,this.doRender()},Ops.Experimental.SaltedPerceptionMaterial.prototype=new Op,Ops.Gl=Ops.Gl||{},Ops.Gl.TextureEffects=Ops.Gl.TextureEffects||{},Ops.Gl.TextureEffects.ImageCompose=function(){function e(){r.useVPSize.val&&(i=cgl.getViewPort()[2],a=cgl.getViewPort()[3]),i==r.tex.width&&a==r.tex.height||0===i||0===a||(r.height.val=a,r.width.val=i,r.tex.setSize(i,a),n.setSourceTexture(r.tex),r.texOut.val=n.getCurrentSourceTexture())}function t(){a=parseInt(r.height.val,10),i=parseInt(r.width.val,10),e()}Op.apply(this,arguments);var r=this;this.name="image compose",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.useVPSize=this.addInPort(new Port(this,"use viewport size",OP_PORT_TYPE_VALUE,{display:"bool"})),this.width=this.addInPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addInPort(new Port(this,"height",OP_PORT_TYPE_VALUE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.texOut=this.addOutPort(new Port(this,"texture_out",OP_PORT_TYPE_TEXTURE,{preview:!0}));var n=new CGL.TextureEffect;cgl.currentTextureEffect=n,this.tex=new CGL.Texture;var i=8,a=8;this.onResize=e,this.useVPSize.onValueChanged=function(){r.useVPSize.val?(r.width.onValueChanged=null,r.height.onValueChanged=null):(r.width.onValueChanged=t,r.height.onValueChanged=t)},this.useVPSize.val=!0,render=function(){cgl.gl.disable(cgl.gl.SCISSOR_TEST),e(),cgl.currentTextureEffect=n,n.startEffect(),r.trigger.trigger(),r.texOut.val=n.getCurrentSourceTexture(),cgl.gl.enable(cgl.gl.SCISSOR_TEST)},this.texOut.onPreviewChanged=function(){r.render.onTriggered=r.texOut.showPreview?r.texOut.val.preview:render,console.log("jaja changed")},this.width.val=1920,this.height.val=1080,this.render.onTriggered=render},Ops.Gl.TextureEffects.ImageCompose.prototype=new Op,Ops.Gl.TextureEffects.Invert=function(){Op.apply(this,arguments);var e=this;this.name="Invert",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.rgb=1.0-col.rgb;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}\n";t.setSource(t.getDefaultVertexShader(),r);new CGL.Uniform(t,"t","tex",0);this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Invert.prototype=new Op,Ops.Gl.TextureEffects.Scroll=function(){Op.apply(this,arguments);var e=this;this.name="Scroll",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.amountX=this.addInPort(new Port(this,"amountX",OP_PORT_TYPE_VALUE)),this.amountY=this.addInPort(new Port(this,"amountY",OP_PORT_TYPE_VALUE));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"".endl()+"  uniform float amountX;".endl()+"  uniform float amountY;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,vec2(mod(texCoord.x+amountX*0.1,1.0),mod(texCoord.y+amountY*0.1,1.0) ));".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}\n";t.setSource(t.getDefaultVertexShader(),r);new CGL.Uniform(t,"t","tex",0);this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())};var n=new CGL.Uniform(t,"f","amountX",1);this.amountX.onValueChanged=function(){n.setValue(e.amountX.val)};var i=new CGL.Uniform(t,"f","amountY",1);this.amountY.onValueChanged=function(){i.setValue(e.amountY.val)},this.amountY.val=0,this.amountX.val=0},Ops.Gl.TextureEffects.Scroll.prototype=new Op,Ops.Gl.TextureEffects.Desaturate=function(){Op.apply(this,arguments);var e=this;this.name="Desaturate",this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"".endl()+"vec3 desaturate(vec3 color, float amount)".endl()+"{".endl()+"   vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), color));".endl()+"   return vec3(mix(color, gray, amount));".endl()+"}".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.rgb=desaturate(col.rgb,amount);".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"f","amount",1));this.amount.onValueChanged=function(){n.setValue(e.amount.val)},this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Desaturate.prototype=new Op,Ops.Gl.TextureEffects.PixelDisplacement=function(){Op.apply(this,arguments);var e=this;this.name="PixelDisplacement",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amountX",OP_PORT_TYPE_VALUE,{display:"range"})),this.amountY=this.addInPort(new Port(this,"amountY",OP_PORT_TYPE_VALUE,{display:"range"})),this.displaceTex=this.addInPort(new Port(this,"displaceTex",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D displaceTex;".endl()+"#endif".endl()+"uniform float amountX;".endl()+"uniform float amountY;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,vec2(mod(texCoord.x+texture2D(displaceTex,texCoord).g*1.0*amountX,1.0),mod(texCoord.y+texture2D(displaceTex,texCoord).g*1.0*amountY,1.0) ) );".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"t","displaceTex",1),new CGL.Uniform(t,"f","amountX",0)),i=new CGL.Uniform(t,"f","amountY",0);this.amount.onValueChanged=function(){n.setValue(e.amount.val)},this.amountY.onValueChanged=function(){i.setValue(e.amountY.val)},this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),e.displaceTex.val&&(cgl.gl.activeTexture(cgl.gl.TEXTURE1),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.displaceTex.val.tex)),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())},e.amount.val=0,e.amountY.val=0},Ops.Gl.TextureEffects.PixelDisplacement.prototype=new Op,Ops.Gl.TextureEffects.MixImage=function(){Op.apply(this,arguments);var e=this;this.name="MixImage",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord)*(1.0-amount);".endl()+"       col+=texture2D(image,texCoord)*amount;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"t","image",1),new CGL.Uniform(t,"f","amount",1));this.amount.onValueChanged=function(){n.setValue(e.amount.val)},e.amount.val=1,this.render.onTriggered=function(){cgl.currentTextureEffect&&(e.image.val&&e.image.val.tex&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.gl.activeTexture(cgl.gl.TEXTURE1),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.image.val.tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader()),e.trigger.trigger())}},Ops.Gl.TextureEffects.MixImage.prototype=new Op,Ops.Gl.TextureEffects.DrawImage=function(){function e(){cgl.currentTextureEffect&&(n.image.val&&n.image.val.tex&&(cgl.setShader(i),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.gl.activeTexture(cgl.gl.TEXTURE1),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,n.image.val.tex),n.imageAlpha.val&&n.imageAlpha.val.tex&&(cgl.gl.activeTexture(cgl.gl.TEXTURE2),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,n.imageAlpha.val.tex)),cgl.currentTextureEffect.finish(),cgl.setPreviousShader()),n.trigger.trigger())}function t(){e(),n.image.val.preview()}function r(){e(),n.imageAlpha.val.preview()}Op.apply(this,arguments);var n=this;this.name="DrawImage",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.blendMode=this.addInPort(new Port(this,"blendMode",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["normal","lighten","darken","multiply","average","add","substract","difference","negation","exclusion","overlay","screen","color dodge","color burn","softlight","hardlight"]})),n.blendMode.val="normal",this.imageAlpha=this.addInPort(new Port(this,"imageAlpha",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.alphaSrc=this.addInPort(new Port(this,"alphaSrc",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["alpha channel","luminance"]})),this.removeAlphaSrc=this.addInPort(new Port(this,"removeAlphaSrc",OP_PORT_TYPE_VALUE,{display:"bool"})),this.invAlphaChannel=this.addInPort(new Port(this,"invert alpha channel",OP_PORT_TYPE_VALUE,{display:"bool"})),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var i=new CGL.Shader;this.onLoaded=i.compile;var a="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"#ifdef HAS_TEXTUREALPHA".endl()+"  uniform sampler2D imageAlpha;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 blendRGBA=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       blendRGBA=texture2D(image,texCoord);".endl()+"vec3 blend=blendRGBA.rgb;".endl()+"vec4 baseRGBA=texture2D(tex,texCoord);".endl()+"vec3 base=baseRGBA.rgb;".endl()+"vec3 colNew=blend;".endl()+"#define Blend(base, blend, funcf)       vec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))".endl()+"#ifdef BM_NORMAL".endl()+"colNew=blend;".endl()+"#endif".endl()+"#ifdef BM_MULTIPLY".endl()+"colNew=base*blend;".endl()+"#endif".endl()+"#ifdef BM_AVERAGE".endl()+"colNew=((base + blend) / 2.0);".endl()+"#endif".endl()+"#ifdef BM_ADD".endl()+"colNew=min(base + blend, vec3(1.0));".endl()+"#endif".endl()+"#ifdef BM_SUBSTRACT".endl()+"colNew=max(base + blend - vec3(1.0), vec3(0.0));".endl()+"#endif".endl()+"#ifdef BM_DIFFERENCE".endl()+"colNew=abs(base - blend);".endl()+"#endif".endl()+"#ifdef BM_NEGATION".endl()+"colNew=(vec3(1.0) - abs(vec3(1.0) - base - blend));".endl()+"#endif".endl()+"#ifdef BM_EXCLUSION".endl()+"colNew=(base + blend - 2.0 * base * blend);".endl()+"#endif".endl()+"#ifdef BM_LIGHTEN".endl()+"colNew=max(blend, base);".endl()+"#endif".endl()+"#ifdef BM_DARKEN".endl()+"colNew=min(blend, base);".endl()+"#endif".endl()+"#ifdef BM_OVERLAY".endl()+"   #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"   colNew=Blend(base, blend, BlendOverlayf);".endl()+"#endif".endl()+"#ifdef BM_SCREEN".endl()+"   #define BlendScreenf(base, blend)       (1.0 - ((1.0 - base) * (1.0 - blend)))".endl()+"   colNew=Blend(base, blend, BlendScreenf);".endl()+"#endif".endl()+"#ifdef BM_SOFTLIGHT".endl()+"   #define BlendSoftLightf(base, blend)    ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))".endl()+"   colNew=Blend(base, blend, BlendSoftLightf);".endl()+"#endif".endl()+"#ifdef BM_HARDLIGHT".endl()+"   #define BlendOverlayf(base, blend)  (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))".endl()+"   colNew=Blend(blend, base, BlendOverlayf);".endl()+"#endif".endl()+"#ifdef BM_COLORDODGE".endl()+"   #define BlendColorDodgef(base, blend)   ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))".endl()+"   colNew=Blend(base, blend, BlendColorDodgef);".endl()+"#endif".endl()+"#ifdef BM_COLORBURN".endl()+"   #define BlendColorBurnf(base, blend)    ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))".endl()+"   colNew=Blend(base, blend, BlendColorBurnf);".endl()+"#endif".endl()+"#ifdef REMOVE_ALPHA_SRC".endl()+"   blendRGBA.a=1.0;".endl()+"#endif".endl()+"#ifdef HAS_TEXTUREALPHA".endl()+"   vec4 colImgAlpha=texture2D(imageAlpha,texCoord);".endl()+"   float colImgAlphaAlpha=colImgAlpha.a;".endl()+"   #ifdef INVERT_ALPHA".endl()+"       colImgAlphaAlpha=1.0-colImgAlphaAlpha;".endl()+"   #endif".endl()+"   #ifdef ALPHA_FROM_LUMINANCE".endl()+"       vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), colImgAlpha.rgb ));".endl()+"       colImgAlphaAlpha=(gray.r+gray.g+gray.b)/3.0;".endl()+"   #endif".endl()+"   blendRGBA.a=colImgAlphaAlpha*blendRGBA.a;".endl()+"#endif".endl()+"blendRGBA.rgb=mix( colNew, base ,1.0-blendRGBA.a*amount);".endl()+"blendRGBA.a=baseRGBA.a+blendRGBA.a;".endl()+"#endif".endl()+"   gl_FragColor = blendRGBA;".endl()+"}";i.setSource(i.getDefaultVertexShader(),a);new CGL.Uniform(i,"t","tex",0),new CGL.Uniform(i,"t","image",1),new CGL.Uniform(i,"t","imageAlpha",2);this.invAlphaChannel.onValueChanged=function(){n.invAlphaChannel.val?i.define("INVERT_ALPHA"):i.removeDefine("INVERT_ALPHA"),i.compile()},this.removeAlphaSrc.onValueChanged=function(){n.removeAlphaSrc.val?i.define("REMOVE_ALPHA_SRC"):i.removeDefine("REMOVE_ALPHA_SRC"),i.compile()},this.alphaSrc.onValueChanged=function(){"luminance"==n.alphaSrc.val?i.define("ALPHA_FROM_LUMINANCE"):i.removeDefine("ALPHA_FROM_LUMINANCE"),i.compile()},this.alphaSrc.val="alpha channel",this.blendMode.onValueChanged=function(){"normal"==n.blendMode.val?i.define("BM_NORMAL"):i.removeDefine("BM_NORMAL"),"multiply"==n.blendMode.val?i.define("BM_MULTIPLY"):i.removeDefine("BM_MULTIPLY"),"average"==n.blendMode.val?i.define("BM_AVERAGE"):i.removeDefine("BM_AVERAGE"),"add"==n.blendMode.val?i.define("BM_ADD"):i.removeDefine("BM_ADD"),"substract"==n.blendMode.val?i.define("BM_SUBSTRACT"):i.removeDefine("BM_SUBSTRACT"),"difference"==n.blendMode.val?i.define("BM_DIFFERENCE"):i.removeDefine("BM_DIFFERENCE"),"negation"==n.blendMode.val?i.define("BM_NEGATION"):i.removeDefine("BM_NEGATION"),"exclusion"==n.blendMode.val?i.define("BM_EXCLUSION"):i.removeDefine("BM_EXCLUSION"),"lighten"==n.blendMode.val?i.define("BM_LIGHTEN"):i.removeDefine("BM_LIGHTEN"),"darken"==n.blendMode.val?i.define("BM_DARKEN"):i.removeDefine("BM_DARKEN"),"overlay"==n.blendMode.val?i.define("BM_OVERLAY"):i.removeDefine("BM_OVERLAY"),"screen"==n.blendMode.val?i.define("BM_SCREEN"):i.removeDefine("BM_SCREEN"),"softlight"==n.blendMode.val?i.define("BM_SOFTLIGHT"):i.removeDefine("BM_SOFTLIGHT"),"hardlight"==n.blendMode.val?i.define("BM_HARDLIGHT"):i.removeDefine("BM_HARDLIGHT"),"color dodge"==n.blendMode.val?i.define("BM_COLORDODGE"):i.removeDefine("BM_COLORDODGE"),"color burn"==n.blendMode.val?i.define("BM_COLORBURN"):i.removeDefine("BM_COLORBURN"),i.compile()};var o=new CGL.Uniform(i,"f","amount",1);this.amount.onValueChanged=function(){o.setValue(n.amount.val)},n.amount.val=1,this.imageAlpha.onValueChanged=function(){n.imageAlpha.val&&n.imageAlpha.val.tex?i.define("HAS_TEXTUREALPHA"):i.removeDefine("HAS_TEXTUREALPHA"),i.compile()},this.image.onPreviewChanged=function(){n.render.onTriggered=n.image.showPreview?t:e},this.imageAlpha.onPreviewChanged=function(){n.render.onTriggered=n.imageAlpha.showPreview?r:e},this.render.onTriggered=e},Ops.Gl.TextureEffects.DrawImage.prototype=new Op,Ops.Gl.TextureEffects.DepthTexture=function(){Op.apply(this,arguments);var e=this;this.name="DepthTexture",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.farPlane=this.addInPort(new Port(this,"farplane",OP_PORT_TYPE_VALUE)),this.nearPlane=this.addInPort(new Port(this,"nearplane",OP_PORT_TYPE_VALUE)),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"uniform float n;".endl()+"uniform float f;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(image,texCoord);".endl()+"       float z=col.r;".endl()+"       float c=(2.0*n)/(f+n-z*(f-n));".endl()+"       col=vec4(c,c,c,1.0);".endl()+"       if(c>=0.99)col.a=0.0;".endl()+"           else col.a=1.0;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","image",0),new CGL.Uniform(t,"f","f",1)),i=new CGL.Uniform(t,"f","n",1);this.farPlane.onValueChanged=function(){n.setValue(e.farPlane.val)},e.farPlane.val=5,this.nearPlane.onValueChanged=function(){i.setValue(e.nearPlane.val)},e.nearPlane.val=.01,this.render.onTriggered=function(){cgl.currentTextureEffect&&(e.image.val&&e.image.val.tex&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.image.val.tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader()),e.trigger.trigger())}},Ops.Gl.TextureEffects.DepthTexture.prototype=new Op,Ops.Gl.TextureEffects.SSAO=function(){Op.apply(this,arguments);var e=this;this.name="SSAO",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.farPlane=this.addInPort(new Port(this,"farplane",OP_PORT_TYPE_VALUE)),this.nearPlane=this.addInPort(new Port(this,"nearplane",OP_PORT_TYPE_VALUE)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.dist=this.addInPort(new Port(this,"dist",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D image;".endl()+"  uniform sampler2D colTex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"uniform float dist;".endl()+"uniform float near;".endl()+"uniform float far;".endl()+"".endl()+"#define samples 8.0".endl()+"#define rings 4.0".endl()+"#define PI    3.14159265".endl()+"".endl()+"float readDepth(vec2 coord)".endl()+"{".endl()+"    return (2.0 * near) / (far + near - texture2D(image, coord ).x * (far-near));".endl()+"}".endl()+"float compareDepths( in float depth1, in float depth2 )".endl()+"{".endl()+"    float aoCap = 1.9;".endl()+"    float aoMultiplier =40.0;".endl()+"    float depthTolerance = 0.001;".endl()+"    float aorange = 100.0;".endl()+"    float diff = sqrt(clamp(1.0-(depth1-depth2) / (aorange/(far-near)),0.0,1.0));".endl()+"    float ao = min(aoCap,max(0.0,depth1-depth2-depthTolerance) * aoMultiplier) * diff;".endl()+"    return ao;".endl()+"}".endl()+"void main()".endl()+"{".endl()+"float d;float ao=1.0;    float depth = readDepth(texCoord);".endl()+"float w=1.0/640.0;".endl()+"float h=1.0/360.0;".endl()+"float pw;".endl()+"float ph;".endl()+"float s=0.0;".endl()+"float fade = 1.0;".endl()+"for (float i = 0.0 ; i < rings; i += 1.0)".endl()+"{".endl()+"   fade *= 0.5;".endl()+"   for (float j = 0.0 ; j < samples; j += 1.0)".endl()+"   {".endl()+"       float step = PI*2.0 / (samples*i);".endl()+"       float jj=j*2.0*i*2.0;".endl()+"       pw = (cos(jj*step)*i);".endl()+"       ph = (sin(jj*step)*i)*2.0;".endl()+"       pw*=dist;".endl()+"       ph*=dist;".endl()+"       d = readDepth( vec2(texCoord.s+pw*w,texCoord.t+ph*h));".endl()+"       ao += compareDepths(depth,d)*fade;".endl()+"       s += 1.0*fade*1.0;".endl()+"   }".endl()+"}".endl()+"ao /= s;".endl()+"ao = 1.0-ao;".endl()+"ao = 1.0-ao;".endl()+"vec4 col=vec4(ao,ao,ao,1.0);".endl()+"col=texture2D(colTex,texCoord)-col*amount;".endl()+"       col.a=1.0;".endl()+"   gl_FragColor = col;".endl()+"}";

t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","image",0),new CGL.Uniform(t,"t","colTex",1),new CGL.Uniform(t,"f","far",1)),i=new CGL.Uniform(t,"f","near",1),a=new CGL.Uniform(t,"f","amount",1),o=new CGL.Uniform(t,"f","dist",1);this.dist.onValueChanged=function(){o.setValue(5*e.dist.val)},e.dist.val=.2,this.amount.onValueChanged=function(){a.setValue(e.amount.val)},e.amount.val=1,this.farPlane.onValueChanged=function(){n.setValue(e.farPlane.val)},e.farPlane.val=5,this.nearPlane.onValueChanged=function(){i.setValue(e.nearPlane.val)},e.nearPlane.val=.01,this.render.onTriggered=function(){cgl.currentTextureEffect&&(e.image.val&&e.image.val.tex&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.image.val.tex),cgl.gl.activeTexture(cgl.gl.TEXTURE1),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader()),e.trigger.trigger())}},Ops.Gl.TextureEffects.SSAO.prototype=new Op,Ops.Gl.TextureEffects.AlphaMask=function(){Op.apply(this,arguments);var e=this;this.name="AlphaMask",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"   #ifdef FROM_RED".endl()+"       col.a=texture2D(image,texCoord).r;".endl()+"   #endif".endl()+"   #ifdef FROM_GREEN".endl()+"       col.a=texture2D(image,texCoord).g;".endl()+"   #endif".endl()+"   #ifdef FROM_BLUE".endl()+"       col.a=texture2D(image,texCoord).b;".endl()+"   #endif".endl()+"   #ifdef FROM_ALPHA".endl()+"       col.a=texture2D(image,texCoord).a;".endl()+"   #endif".endl()+"   #ifdef FROM_LUMINANCE".endl()+"       vec3 gray = vec3(dot(vec3(0.2126,0.7152,0.0722), texture2D(image,texCoord).rgb ));".endl()+"       col.a=(gray.r+gray.g+gray.b)/3.0;".endl()+"   #endif".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"t","image",1);this.method=this.addInPort(new Port(this,"method",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["luminance","image alpha","red","green","blue"]})),this.method.onValueChanged=function(){"luminance"==e.method.val?t.define("FROM_LUMINANCE"):t.removeDefine("FROM_LUMINANCE"),"image alpha"==e.method.val?t.define("FROM_ALPHA"):t.removeDefine("FROM_ALPHA"),"red"==e.method.val?t.define("FROM_RED"):t.removeDefine("FROM_RED"),"green"==e.method.val?t.define("FROM_GREEN"):t.removeDefine("FROM_GREEN"),"blue"==e.method.val?t.define("FROM_BLUE"):t.removeDefine("FROM_BLUE")},this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),e.image.val&&e.image.val.tex&&(cgl.gl.activeTexture(cgl.gl.TEXTURE1),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.image.val.tex)),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.AlphaMask.prototype=new Op,Ops.Gl.TextureEffects.WipeTransition=function(){Op.apply(this,arguments);var e=this;this.name="WipeTransition",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.fade=this.addInPort(new Port(this,"fade",OP_PORT_TYPE_VALUE,{display:"range"})),this.fadeWidth=this.addInPort(new Port(this,"fadeWidth",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"#endif".endl()+"uniform float fade;".endl()+"uniform float fadeWidth;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       vec4 colWipe=texture2D(image,texCoord);".endl()+"       float w=fadeWidth;".endl()+"       float v=colWipe.r;".endl()+"       float f=fade+fade*w;".endl()+"       if(f<v) col.a=1.0;".endl()+"       else if(f>v+w) col.a=0.0;".endl()+"       else if(f>v && f<=v+w) col.a = 1.0-(f-v)/w; ;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"t","image",1),new CGL.Uniform(t,"f","fade",0)),i=new CGL.Uniform(t,"f","fadeWidth",0);this.fade.onValueChanged=function(){n.setValue(e.fade.val)},this.fadeWidth.onValueChanged=function(){i.setValue(e.fadeWidth.val)},this.fade.val=.5,this.fadeWidth.val=.2,this.render.onTriggered=function(){cgl.currentTextureEffect&&(e.image.val&&e.image.val.tex&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.gl.activeTexture(cgl.gl.TEXTURE1),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.image.val.tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader()),e.trigger.trigger())}},Ops.Gl.TextureEffects.WipeTransition.prototype=new Op,Ops.Gl.TextureEffects.ColorLookup=function(){Op.apply(this,arguments);var e=this;this.name="ColorLookup",this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.posy=this.addInPort(new Port(this,"posy",OP_PORT_TYPE_VALUE,{display:"range"})),this.image=this.addInPort(new Port(this,"image",OP_PORT_TYPE_TEXTURE)),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform sampler2D image;".endl()+"  uniform float posy;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.r=col.r*(1.0-amount)+texture2D(image,vec2(col.r,posy)).r*amount;".endl()+"       col.g=col.g*(1.0-amount)+texture2D(image,vec2(col.g,posy)).g*amount;".endl()+"       col.b=col.b*(1.0-amount)+texture2D(image,vec2(col.b,posy)).b*amount;".endl()+"   #endif".endl()+"   col.a=1.0;".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"t","image",1),new CGL.Uniform(t,"f","amount",1));this.amount.onValueChanged=function(){n.setValue(e.amount.val)};var i=new CGL.Uniform(t,"f","posy",0);this.posy.onValueChanged=function(){i.setValue(e.posy.val)},this.posy.val=0,this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),e.image.val&&e.image.val.tex&&(cgl.gl.activeTexture(cgl.gl.TEXTURE1),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.image.val.tex)),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.ColorLookup.prototype=new Op,Ops.Gl.TextureEffects.BrightnessContrast=function(){Op.apply(this,arguments);var e=this;this.name="BrightnessContrast",this.amount=this.addInPort(new Port(this,"contrast",OP_PORT_TYPE_VALUE,{display:"range"})),this.amountBright=this.addInPort(new Port(this,"brightness",OP_PORT_TYPE_VALUE,{display:"range"})),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"uniform float amountbright;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       // apply contrast".endl()+"       col.rgb = ((col.rgb - 0.5) * max(amount*2.0, 0.0))+0.5;".endl()+"       // apply brightness".endl()+"       col.rgb += amountbright;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"f","amount",.4)),i=new CGL.Uniform(t,"f","amountbright",0);this.amount.onValueChanged=function(){console.log("amount changed! "+e.amount.val),n.setValue(e.amount.val)},this.amountBright.onValueChanged=function(){i.setValue(e.amountBright.val)},this.amountBright.val=0,this.amount.val=.5,this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.BrightnessContrast.prototype=new Op,Ops.Gl.TextureEffects.RemoveAlpha=function(){Op.apply(this,arguments);var e=this;this.name="RemoveAlpha",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.a=1.0;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);new CGL.Uniform(t,"t","tex",0);this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.RemoveAlpha.prototype=new Op,Ops.Gl.TextureEffects.ColorOverlay=function(){Op.apply(this,arguments);var e=this;this.name="ColorOverlay",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"}));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform float r;".endl()+"  uniform float g;".endl()+"  uniform float b;".endl()+"  uniform float a;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"   #endif".endl()+"   vec4 overCol=vec4(r,g,b,col.a);".endl()+"   col=mix(col,overCol, a);".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);new CGL.Uniform(t,"t","tex",0);this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())};var n=new CGL.Uniform(t,"f","r",1),i=new CGL.Uniform(t,"f","g",1),a=new CGL.Uniform(t,"f","b",1),o=new CGL.Uniform(t,"f","a",1);this.r.onValueChanged=function(){n.setValue(e.r.val)},this.g.onValueChanged=function(){i.setValue(e.g.val)},this.b.onValueChanged=function(){a.setValue(e.b.val)},this.a.onValueChanged=function(){o.setValue(e.a.val)},this.a.val=1,this.r.val=1,this.g.val=0,this.b.val=0},Ops.Gl.TextureEffects.ColorOverlay.prototype=new Op,Ops.Gl.TextureEffects.ColorChannel=function(){Op.apply(this,arguments);var e=this;this.name="ColorChannel",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(0.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"   #ifdef CHANNEL_R".endl()+"       col.r=texture2D(tex,texCoord).r;".endl()+"       #ifdef MONO".endl()+"           col.g=col.b=col.r;".endl()+"       #endif".endl()+"   #endif".endl()+"   #ifdef CHANNEL_G".endl()+"       col.g=texture2D(tex,texCoord).g;".endl()+"       #ifdef MONO".endl()+"           col.r=col.b=col.g;".endl()+"       #endif".endl()+"   #endif".endl()+"   #ifdef CHANNEL_B".endl()+"       col.b=texture2D(tex,texCoord).b;".endl()+"       #ifdef MONO".endl()+"           col.g=col.r=col.b;".endl()+"       #endif".endl()+"   #endif".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);new CGL.Uniform(t,"t","tex",0);this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())},this.channelR=this.addInPort(new Port(this,"channelR",OP_PORT_TYPE_VALUE,{display:"bool"})),this.channelR.onValueChanged=function(){e.channelR.val?t.define("CHANNEL_R"):t.removeDefine("CHANNEL_R")},this.channelR.val=!0,this.channelG=this.addInPort(new Port(this,"channelG",OP_PORT_TYPE_VALUE,{display:"bool"})),this.channelG.val=!1,this.channelG.onValueChanged=function(){e.channelG.val?t.define("CHANNEL_G"):t.removeDefine("CHANNEL_G")},this.channelB=this.addInPort(new Port(this,"channelB",OP_PORT_TYPE_VALUE,{display:"bool"})),this.channelB.val=!1,this.channelB.onValueChanged=function(){e.channelB.val?t.define("CHANNEL_B"):t.removeDefine("CHANNEL_B")},this.mono=this.addInPort(new Port(this,"mono",OP_PORT_TYPE_VALUE,{display:"bool"})),this.mono.val=!1,this.mono.onValueChanged=function(){e.mono.val?t.define("MONO"):t.removeDefine("MONO")}},Ops.Gl.TextureEffects.ColorChannel.prototype=new Op,Ops.Gl.TextureEffects.RgbMultiply=function(){Op.apply(this,arguments);var e=this;this.name="RgbMultiply",this.r=this.addInPort(new Port(this,"r")),this.g=this.addInPort(new Port(this,"g")),this.b=this.addInPort(new Port(this,"b")),this.r.val=1,this.g.val=1,this.b.val=1,this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float r;".endl()+"uniform float g;".endl()+"uniform float b;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       col.r*=r;".endl()+"       col.g*=g;".endl()+"       col.b*=b;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"f","r",1)),i=new CGL.Uniform(t,"f","g",1),a=new CGL.Uniform(t,"f","b",1);this.r.onValueChanged=function(){n.setValue(e.r.val)},this.g.onValueChanged=function(){i.setValue(e.g.val)},this.b.onValueChanged=function(){a.setValue(e.b.val)},this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.RgbMultiply.prototype=new Op,Ops.Gl.TextureEffects.Hue=function(){Op.apply(this,arguments);var e=this;this.name="Hue",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.hue=this.addInPort(new Port(this,"hue",OP_PORT_TYPE_VALUE,{display:"range"})),this.hue.val=1,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float hue;".endl()+"".endl()+"vec3 rgb2hsv(vec3 c)".endl()+"{".endl()+"    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);".endl()+"    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));".endl()+"    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));".endl()+"".endl()+"    float d = q.x - min(q.w, q.y);".endl()+"    float e = 1.0e-10;".endl()+"    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);".endl()+"}".endl()+"vec3 hsv2rgb(vec3 c)".endl()+"{".endl()+"    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);".endl()+"    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);".endl()+"    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);".endl()+"}".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       vec3 hsv = rgb2hsv(col.rgb);".endl()+"       hsv.x=hsv.x+hue;".endl()+"       col.rgb = hsv2rgb(hsv);".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"f","hue",1));this.hue.onValueChanged=function(){n.setValue(e.hue.val)},this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Hue.prototype=new Op,Ops.Gl.TextureEffects.Color=function(){Op.apply(this,arguments);var e=this;this.name="Color",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float r;".endl()+"uniform float g;".endl()+"uniform float b;".endl()+"uniform float a;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(r,g,b,a);".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"f","r",1)),i=new CGL.Uniform(t,"f","g",1),a=new CGL.Uniform(t,"f","b",1),o=new CGL.Uniform(t,"f","a",1);this.r.onValueChanged=function(){n.setValue(e.r.val)},this.g.onValueChanged=function(){i.setValue(e.g.val)},this.b.onValueChanged=function(){a.setValue(e.b.val)},this.a.onValueChanged=function(){o.setValue(e.a.val)},this.r.val=1,this.g.val=1,this.b.val=1,this.a.val=1,this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Color.prototype=new Op,Ops.Gl.TextureEffects.Vignette=function(){Op.apply(this,arguments);var e=this;this.name="Vignette",this.lensRadius1=this.addInPort(new Port(this,"lensRadius1")),this.lensRadius2=this.addInPort(new Port(this,"lensRadius2")),this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float lensRadius1;".endl()+"uniform float lensRadius2;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       vec2 tcPos=vec2(texCoord.x,texCoord.y/1.777+0.25);".endl()+"       float dist = distance(tcPos, vec2(0.5,0.5));".endl()+"       col.rgb *= smoothstep(lensRadius1, lensRadius2, dist);".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"f","lensRadius1",.4)),i=new CGL.Uniform(t,"f","lensRadius2",.3);this.lensRadius1.onValueChanged=function(){n.setValue(e.lensRadius1.val)},this.lensRadius2.onValueChanged=function(){i.setValue(e.lensRadius2.val)},this.lensRadius1.val=.8,this.lensRadius2.val=.4,this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.Vignette.prototype=new Op,Ops.Gl.TextureEffects.Blur=function(){Op.apply(this,arguments);var e=this;this.name="Blur",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.iterations=this.addInPort(new Port(this,"iterations",OP_PORT_TYPE_VALUE)),this.iterations.val=10;var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"  uniform float dirX;".endl()+"  uniform float dirY;".endl()+"  uniform float width;".endl()+"  uniform float height;".endl()+"#endif".endl()+"".endl()+"vec4 blur9(sampler2D texture, vec2 uv, vec2 red, vec2 dir)".endl()+"{".endl()+"   vec4 color = vec4(0.0);".endl()+"   vec2 offset1 = vec2(1.3846153846) * dir;".endl()+"   vec2 offset2 = vec2(3.2307692308) * dir;".endl()+"   color += texture2D(texture, uv) * 0.2270270270;".endl()+"   color += texture2D(texture, uv + (offset1 / red)) * 0.3162162162;".endl()+"   color += texture2D(texture, uv - (offset1 / red)) * 0.3162162162;".endl()+"   color += texture2D(texture, uv + (offset2 / red)) * 0.0702702703;".endl()+"   color += texture2D(texture, uv - (offset2 / red)) * 0.0702702703;".endl()+"   return color;".endl()+"}".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=blur9(tex,texCoord,vec2(width,height),vec2(dirX,dirY));".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"f","dirX",0)),i=new CGL.Uniform(t,"f","dirY",0),a=new CGL.Uniform(t,"f","width",0),o=new CGL.Uniform(t,"f","height",0);this.render.onTriggered=function(){if(cgl.currentTextureEffect){cgl.setShader(t),a.setValue(cgl.currentTextureEffect.getCurrentSourceTexture().width),o.setValue(cgl.currentTextureEffect.getCurrentSourceTexture().height);for(var r=0;r<e.iterations.val;r++)cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),n.setValue(0),i.setValue(1),cgl.currentTextureEffect.finish(),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),n.setValue(1),i.setValue(0),cgl.currentTextureEffect.finish();cgl.setPreviousShader(),e.trigger.trigger()}}},Ops.Gl.TextureEffects.Blur.prototype=new Op,Ops.Gl.TextureEffects.FXAA=function(){function e(){l.setValue(t.texWidth.val),s.setValue(t.texHeight.val)}Op.apply(this,arguments);var t=this;this.name="FXAA",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.fxaa_span=this.addInPort(new Port(this,"span",OP_PORT_TYPE_VALUE,{display:"dropdown",values:[0,2,4,8,16,32,64]})),this.fxaa_reduceMin=this.addInPort(new Port(this,"reduceMin",OP_PORT_TYPE_VALUE)),this.fxaa_reduceMul=this.addInPort(new Port(this,"reduceMul",OP_PORT_TYPE_VALUE)),this.texWidth=this.addInPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.texHeight=this.addInPort(new Port(this,"height",OP_PORT_TYPE_VALUE));var r=new CGL.Shader;this.onLoaded=r.compile;var n="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"    uniform float FXAA_SPAN_MAX;".endl()+"    uniform float FXAA_REDUCE_MUL;".endl()+"    uniform float FXAA_REDUCE_MIN;".endl()+"    uniform float width;".endl()+"    uniform float height;".endl()+"vec4 getColorFXAA(vec2 coord)".endl()+"{".endl()+"    vec2 invtexsize=vec2(1.0/width,1.0/height);".endl()+"".endl()+"    float step=1.0;".endl()+"".endl()+"    vec3 rgbNW = texture2D(tex, coord.xy + (vec2(-step, -step)*invtexsize )).xyz;".endl()+"    vec3 rgbNE = texture2D(tex, coord.xy + (vec2(+step, -step)*invtexsize )).xyz;".endl()+"    vec3 rgbSW = texture2D(tex, coord.xy + (vec2(-step, +step)*invtexsize )).xyz;".endl()+"    vec3 rgbSE = texture2D(tex, coord.xy + (vec2(+step, +step)*invtexsize )).xyz;".endl()+"    vec3 rgbM  = texture2D(tex, coord.xy).xyz;".endl()+"".endl()+"    vec3 luma = vec3(0.299, 0.587, 0.114);".endl()+"    float lumaNW = dot(rgbNW, luma);".endl()+"    float lumaNE = dot(rgbNE, luma);".endl()+"    float lumaSW = dot(rgbSW, luma);".endl()+"    float lumaSE = dot(rgbSE, luma);".endl()+"    float lumaM  = dot( rgbM, luma);".endl()+"".endl()+"    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));".endl()+"    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));".endl()+"".endl()+"    vec2 dir;".endl()+"    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));".endl()+"    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));".endl()+"".endl()+"    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);".endl()+"".endl()+"    float rcpDirMin = 1.0/(min(abs(dir.x), abs(dir.y)) + dirReduce);".endl()+"".endl()+"    dir = min(vec2(FXAA_SPAN_MAX,  FXAA_SPAN_MAX),".endl()+"          max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin))*invtexsize ;".endl()+"".endl()+"    vec3 rgbA = (1.0/2.0) * (".endl()+"                texture2D(tex, coord.xy + dir * (1.0/3.0 - 0.5)).xyz +".endl()+"                texture2D(tex, coord.xy + dir * (2.0/3.0 - 0.5)).xyz);".endl()+"    vec3 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (".endl()+"                texture2D(tex, coord.xy + dir * (0.0/3.0 - 0.5)).xyz +".endl()+"                texture2D(tex, coord.xy + dir * (3.0/3.0 - 0.5)).xyz);".endl()+"    float lumaB = dot(rgbB, luma);".endl()+"".endl()+"    vec4 color=texture2D(tex,coord).rgba;".endl()+"".endl()+"    if((lumaB < lumaMin) || (lumaB > lumaMax)){".endl()+"      color.xyz=rgbA;".endl()+"    } else {".endl()+"      color.xyz=rgbB;".endl()+"    }".endl()+"    return color;".endl()+"}".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   gl_FragColor = getColorFXAA(texCoord);".endl()+"}";r.setSource(r.getDefaultVertexShader(),n);new CGL.Uniform(r,"t","tex",0);this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(r),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),t.trigger.trigger())};var i=new CGL.Uniform(r,"f","FXAA_SPAN_MAX",0),a=new CGL.Uniform(r,"f","FXAA_REDUCE_MUL",0),o=new CGL.Uniform(r,"f","FXAA_REDUCE_MIN",0);this.fxaa_span.onValueChanged=function(){i.setValue(parseInt(t.fxaa_span.val,10))};var l=new CGL.Uniform(r,"f","width",0),s=new CGL.Uniform(r,"f","height",0);this.texWidth.onValueChanged=e,this.texHeight.onValueChanged=e,this.fxaa_span.val=8,this.texWidth.val=1920,this.texHeight.val=1080,this.fxaa_reduceMul.onValueChanged=function(){a.setValue(1/t.fxaa_reduceMul.val)},this.fxaa_reduceMin.onValueChanged=function(){o.setValue(1/t.fxaa_reduceMin.val)},this.fxaa_reduceMul.val=8,this.fxaa_reduceMin.val=128},Ops.Gl.TextureEffects.FXAA.prototype=new Op,Ops.Gl.TextureEffects.Noise=function(){Op.apply(this,arguments);var e=this;this.name="Noise",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"uniform float time;".endl()+"float random(vec2 co)".endl()+"{".endl()+"   return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);".endl()+"}".endl()+"void main()".endl()+"{".endl()+"   float c=random(time*texCoord.xy);".endl()+"   vec4 col=texture2D(tex,texCoord);".endl()+"   col.rgb=mix(col.rgb,vec3(c),amount);".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);new CGL.Uniform(t,"t","tex",0);this.render.onTriggered=function(){cgl.currentTextureEffect&&(i.setValue(e.patch.timer.getTime()),cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())};var n=new CGL.Uniform(t,"f","amount",1),i=new CGL.Uniform(t,"f","time",1);this.amount.onValueChanged=function(){n.setValue(e.amount.val)},this.amount.val=.3},Ops.Gl.TextureEffects.Noise.prototype=new Op,Ops.Gl.TextureEffects.ChromaticAberration=function(){
Op.apply(this,arguments);var e=this;this.name="ChromaticAberration",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.amount=this.addInPort(new Port(this,"amount",OP_PORT_TYPE_VALUE,{display:"range"})),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var t=new CGL.Shader;this.onLoaded=t.compile;var r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"  varying vec2 texCoord;".endl()+"  uniform sampler2D tex;".endl()+"#endif".endl()+"uniform float amount;".endl()+"".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1.0,0.0,0.0,1.0);".endl()+"   #ifdef HAS_TEXTURES".endl()+"       col=texture2D(tex,texCoord);".endl()+"       vec2 tcPos=vec2(texCoord.x,texCoord.y/1.777+0.25);".endl()+"       float dist = distance(tcPos, vec2(0.5,0.5));".endl()+"       col.r=texture2D(tex,texCoord+(dist)*-amount).r;".endl()+"       col.b=texture2D(tex,texCoord+(dist)*amount).b;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}";t.setSource(t.getDefaultVertexShader(),r);var n=(new CGL.Uniform(t,"t","tex",0),new CGL.Uniform(t,"f","amount",0));this.amount.onValueChanged=function(){n.setValue(.1*e.amount.val)},this.amount.val=.5,this.render.onTriggered=function(){cgl.currentTextureEffect&&(cgl.setShader(t),cgl.currentTextureEffect.bind(),cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,cgl.currentTextureEffect.getCurrentSourceTexture().tex),cgl.currentTextureEffect.finish(),cgl.setPreviousShader(),e.trigger.trigger())}},Ops.Gl.TextureEffects.ChromaticAberration.prototype=new Op,Ops.Gl=Ops.Gl||{},Ops.Gl.Renderer=function(){Op.apply(this,arguments);var e=this;this.name="renderer",this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.width=this.addOutPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addOutPort(new Port(this,"height",OP_PORT_TYPE_VALUE));var t=vec3.create();vec3.set(t,0,0,-2),cgl.canvas=document.getElementById("glcanvas"),cgl.patch=e.patch,this.onAnimFrame=function(r){(cgl.canvasWidth!=cgl.canvas.clientWidth||cgl.canvasHeight!=cgl.canvas.clientHeight)&&(cgl.canvasWidth=cgl.canvas.clientWidth,e.width.val=cgl.canvasWidth,cgl.canvasHeight=cgl.canvas.clientHeight,e.height.val=cgl.canvasHeight),Ops.Gl.Renderer.renderStart(t),e.trigger.trigger(),CGL.Texture.previewTexture&&(CGL.Texture.texturePreviewer||(CGL.Texture.texturePreviewer=new CGL.Texture.texturePreview),CGL.Texture.texturePreviewer.render(CGL.Texture.previewTexture)),Ops.Gl.Renderer.renderEnd()}},Ops.Gl.Renderer.renderStart=function(e){cgl.gl.enable(cgl.gl.DEPTH_TEST),cgl.gl.clearColor(0,0,0,1),cgl.gl.clear(cgl.gl.COLOR_BUFFER_BIT|cgl.gl.DEPTH_BUFFER_BIT),cgl.setViewPort(0,0,cgl.canvas.clientWidth,cgl.canvas.clientHeight),mat4.perspective(cgl.pMatrix,45,cgl.canvasWidth/cgl.canvasHeight,.01,1100),cgl.pushPMatrix(),cgl.pushMvMatrix(),mat4.identity(cgl.mvMatrix),mat4.translate(cgl.mvMatrix,cgl.mvMatrix,e),cgl.gl.enable(cgl.gl.BLEND),cgl.gl.blendFunc(cgl.gl.SRC_ALPHA,cgl.gl.ONE_MINUS_SRC_ALPHA),cgl.beginFrame()},Ops.Gl.Renderer.renderEnd=function(e){cgl.popMvMatrix(),cgl.popPMatrix(),cgl.endFrame()},Ops.Gl.Renderer.prototype=new Op,Ops.Gl.LetterBox=function(){function e(){var e=cgl.canvasHeight*t.ratio.val,o=cgl.canvasHeight,l=0,s=0;if(e>cgl.canvasWidth&&(e=cgl.canvasWidth,o=cgl.canvasWidth/t.ratio.val),e<cgl.canvasWidth&&(l=(cgl.canvasWidth-e)/2),o<cgl.canvasHeight&&(s=(cgl.canvasHeight-o)/2),e!=i||o!=a||l!=r||s!=n){i=e,a=o,r=l,n=s,cgl.setViewPort(r,n,i,a);for(var d=0;d<t.patch.ops.length;d++)t.patch.ops[d].onResize&&t.patch.ops[d].onResize()}}Op.apply(this,arguments);var t=this;this.name="letterbox",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.ratio=this.addInPort(new Port(this,"ratio",OP_PORT_TYPE_VALUE,{display:"dropdown",values:[1.25,1.3333333333,1.777777777778,2.33333333333333]})),this.ratio.val=1.777777777778;var r=0,n=0,i=1e3,a=1e3;this.render.onTriggered=function(){cgl.gl.enable(cgl.gl.SCISSOR_TEST),e(),cgl.gl.scissor(r,n,i,a),cgl.setViewPort(r,n,i,a),mat4.perspective(cgl.pMatrix,45,t.ratio.val,.01,1100),t.trigger.trigger(),cgl.gl.disable(cgl.gl.SCISSOR_TEST)}},Ops.Gl.LetterBox.prototype=new Op,Ops.Gl.AspectRatioBorder=Ops.Gl.LetterBox,Ops.Gl.ClearAlpha=function(){Op.apply(this,arguments);var e=this;this.name="ClearAlpha",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.a.val=1,this.render.onTriggered=function(){cgl.gl.colorMask(!1,!1,!1,!0),cgl.gl.clearColor(0,0,0,e.a.val),cgl.gl.clear(cgl.gl.GL_COLOR_BUFFER_BIT|cgl.gl.GL_DEPTH_BUFFER_BIT),cgl.gl.colorMask(!0,!0,!0,!0),e.trigger.trigger()}},Ops.Gl.ClearAlpha.prototype=new Op,Ops.Gl.ClearColor=function(){Op.apply(this,arguments);var e=this;this.name="ClearColor",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.r.val=.3,this.g.val=.3,this.b.val=.3,this.a.val=1,this.render.onTriggered=function(){cgl.gl.clearColor(e.r.val,e.g.val,e.b.val,e.a.val),cgl.gl.clear(cgl.gl.COLOR_BUFFER_BIT|cgl.gl.DEPTH_BUFFER_BIT),e.trigger.trigger()}},Ops.Gl.ClearColor.prototype=new Op,Ops.Gl.Depth=function(){Op.apply(this,arguments);var e=this;this.name="Depth",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.clear=this.addInPort(new Port(this,"clear depth",OP_PORT_TYPE_VALUE,{display:"bool"})),this.enable=this.addInPort(new Port(this,"enable depth testing",OP_PORT_TYPE_VALUE,{display:"bool"})),this.write=this.addInPort(new Port(this,"write to depth buffer",OP_PORT_TYPE_VALUE,{display:"bool"})),this.depthFunc=this.addInPort(new Port(this,"ratio",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["never","always","less","less or equal","greater","greater or equal","equal","not equal"]}));var t=cgl.gl.LEQUAL;this.depthFunc.onValueChanged=function(){"never"==e.depthFunc.val&&(t=cgl.gl.NEVER),"always"==e.depthFunc.val&&(t=cgl.gl.ALWAYS),"less"==e.depthFunc.val&&(t=cgl.gl.LESS),"less or equal"==e.depthFunc.val&&(t=cgl.gl.LEQUAL),"greater"==e.depthFunc.val&&(t=cgl.gl.GREATER),"greater or equal"==e.depthFunc.val&&(t=cgl.gl.EQUAL),"equal"==e.depthFunc.val&&(t=cgl.gl.EQUAL),"not equal"==e.depthFunc.val&&(t=cgl.gl.NOTEQUAL)},this.depthFunc.val="less or equal",this.clear.val=!1,this.enable.val=!0,this.write.val=!0,this.render.onTriggered=function(){!0===e.clear.val&&cgl.gl.clear(cgl.gl.DEPTH_BUFFER_BIT),!0!==e.enable.val&&cgl.gl.disable(cgl.gl.DEPTH_TEST),!0!==e.write.val&&cgl.gl.depthMask(!1),cgl.gl.depthFunc(t),e.trigger.trigger(),cgl.gl.enable(cgl.gl.DEPTH_TEST),cgl.gl.depthMask(!0),cgl.gl.depthFunc(cgl.gl.LEQUAL)}},Ops.Gl.Depth.prototype=new Op,Ops.Gl.ClearDepth=function(){Op.apply(this,arguments);var e=this;this.name="ClearDepth",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){cgl.gl.clear(cgl.gl.DEPTH_BUFFER_BIT),e.trigger.trigger()}},Ops.Gl.ClearDepth.prototype=new Op,Ops.Gl.Wireframe=function(){Op.apply(this,arguments);var e=this;this.name="Wireframe",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.lineWidth=this.addInPort(new Port(this,"lineWidth")),this.render.onTriggered=function(){cgl.wireframe=!0,cgl.gl.lineWidth(e.lineWidth.val),e.trigger.trigger(),cgl.wireframe=!1},this.lineWidth.val=2},Ops.Gl.Wireframe.prototype=new Op,Ops.Gl.Points=function(){Op.apply(this,arguments);var e=this;this.name="Points",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.pointSize=this.addInPort(new Port(this,"pointSize")),this.render.onTriggered=function(){cgl.points=!0,e.trigger.trigger(),cgl.points=!1},this.pointSize.val=5},Ops.Gl.Points.prototype=new Op,Ops.Gl.Mouse=function(){Op.apply(this,arguments);var e=this;this.name="mouse",this.mouseX=this.addOutPort(new Port(this,"x",OP_PORT_TYPE_VALUE)),this.mouseY=this.addOutPort(new Port(this,"y",OP_PORT_TYPE_VALUE)),this.canvas=document.getElementById("glcanvas"),this.canvas.onmousemove=function(t){e.mouseX.val=t.offsetX,e.mouseY.val=t.offsetY}},Ops.Gl.Mouse.prototype=new Op,Ops.Gl.TextureEmpty=function(){Op.apply(this,arguments);var e=this;this.name="texture empty",this.width=this.addInPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addInPort(new Port(this,"height",OP_PORT_TYPE_VALUE)),this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.tex=new CGL.Texture;var t=function(){e.tex.setSize(e.width.val,e.height.val),e.textureOut.val=e.tex};this.width.onValueChanged=t,this.height.onValueChanged=t,this.width.val=8,this.height.val=8},Ops.Gl.TextureEmpty.prototype=new Op,Ops.Gl.Texture=function(){Op.apply(this,arguments);var e=this;this.name="texture",this.filename=this.addInPort(new Port(this,"file",OP_PORT_TYPE_VALUE,{display:"file",filter:"image"})),this.filter=this.addInPort(new Port(this,"filter",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["nearest","linear","mipmap"]})),this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.width=this.addOutPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addOutPort(new Port(this,"height",OP_PORT_TYPE_VALUE)),this.filter.val="linear",this.cgl_filter=CGL.Texture.FILTER_LINEAR;var t=function(){console.log("load texture..."),e.tex=CGL.Texture.load(e.filename.val,function(){e.textureOut.val=e.tex,e.width.val=e.tex.width,e.height.val=e.tex.height},{filter:e.cgl_filter}),e.textureOut.val=e.tex};this.filename.onValueChanged=t,this.filter.onValueChanged=function(){"nearest"==e.filter.val&&(e.cgl_filter=CGL.Texture.FILTER_NEAREST),"linear"==e.filter.val&&(e.cgl_filter=CGL.Texture.FILTER_LINEAR),"mipmap"==e.filter.val&&(e.cgl_filter=CGL.Texture.FILTER_MIPMAP),t()},this.textureOut.onPreviewChanged=function(){e.textureOut.showPreview&&(CGL.Texture.previewTexture=e.textureOut.val)}},Ops.Gl.Texture.prototype=new Op,Ops.Gl.TextureText=function(){function e(){a.clearRect(0,0,r.width,r.height),a.fillStyle="white",a.font=t.fontSize.val+"px "+t.font.val,a.textAlign=t.align.val,"center"==t.align.val&&a.fillText(t.text.val,a.canvas.width/2,a.canvas.height/2),"left"==t.align.val&&a.fillText(t.text.val,0,a.canvas.height/2),"right"==t.align.val&&a.fillText(t.text.val,a.canvas.width,a.canvas.height/2),a.restore(),t.textureOut.val?t.textureOut.val.initTexture(i):t.textureOut.val=new CGL.Texture.fromImage(i)}Op.apply(this,arguments);var t=this;this.name="TextureText",this.text=this.addInPort(new Port(this,"text",{type:"string"})),this.fontSize=this.addInPort(new Port(this,"fontSize")),this.align=this.addInPort(new Port(this,"align",OP_PORT_TYPE_VALUE,{display:"dropdown",values:["left","center","right"]})),this.font=this.addInPort(new Port(this,"font")),this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.fontSize.val=30,this.font.val="Arial",this.align.val="center";var r=document.createElement("canvas");r.id="hiddenCanvas",r.width=512,r.height=512,r.style.display="none";var n=document.getElementsByTagName("body")[0];n.appendChild(r);var i=document.getElementById("hiddenCanvas"),a=i.getContext("2d");this.align.onValueChanged=e,this.text.onValueChanged=e,this.fontSize.onValueChanged=e,this.font.onValueChanged=e,this.text.val="cables"},Ops.Gl.TextureText.prototype=new Op,Ops.Gl.Meshes=Ops.Gl.Meshes||{},Ops.Gl.Meshes.Plotter=function(){function e(){cgl.gl.lineWidth(4),cgl.gl.bindBuffer(cgl.gl.ARRAY_BUFFER,t.buffer),cgl.gl.bufferData(cgl.gl.ARRAY_BUFFER,new Float32Array(t.vertices),cgl.gl.STATIC_DRAW),t.buffer.itemSize=3,t.buffer.numItems=r}Op.apply(this,arguments);var t=this;this.name="Plotter",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.v=this.addInPort(new Port(this,"value")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){cgl.gl.vertexAttribPointer(cgl.getShader().getAttrVertexPos(),t.buffer.itemSize,cgl.gl.FLOAT,!1,0,0),cgl.getShader().bind(),cgl.gl.bindBuffer(cgl.gl.ARRAY_BUFFER,t.buffer),cgl.gl.drawArrays(cgl.gl.LINE_STRIP,0,t.buffer.numItems),t.trigger.trigger()},this.buffer=cgl.gl.createBuffer();var r=50;this.vertices=[];for(var n=0;r>n;n++)this.vertices.push(1/r*n),this.vertices.push(Math.random()-.5),this.vertices.push(0);e(),this.v.onValueChanged=function(){t.vertices.splice(0,3),t.vertices.push(1),t.vertices.push(t.v.val),t.vertices.push(0);for(var n=0;3*r>n;n+=3)t.vertices[n]=1/r*n;e()}},Ops.Gl.Meshes.Plotter.prototype=new Op,Ops.Gl.Matrix={},Ops.Gl.Matrix.Translate=function(){Op.apply(this,arguments);var e=this;this.name="translate",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.x=this.addInPort(new Port(this,"x")),this.y=this.addInPort(new Port(this,"y")),this.z=this.addInPort(new Port(this,"z")),this.x.val=0,this.y.val=0,this.z.val=0;var t=vec3.create();this.render.onTriggered=function(){vec3.set(t,e.x.val,e.y.val,e.z.val),cgl.pushMvMatrix(),mat4.translate(cgl.mvMatrix,cgl.mvMatrix,t),e.trigger.trigger(),cgl.popMvMatrix()}},Ops.Gl.Matrix.Translate.prototype=new Op,Ops.Gl.Matrix.Scale=function(){Op.apply(this,arguments);var e=this;this.name="scale",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.scale=this.addInPort(new Port(this,"scale"));var t=vec3.create(),r=mat4.create();mat4.identity(r);var n=!1;this.render.onTriggered=function(){cgl.pushMvMatrix(),mat4.multiply(cgl.mvMatrix,cgl.mvMatrix,r),e.trigger.trigger(),cgl.popMvMatrix()};var i=function(){mat4.identity(r),mat4.scale(r,r,t)};this.scaleChanged=function(){n=!1,vec3.set(t,e.scale.val,e.scale.val,e.scale.val),i()},this.scale.onValueChanged=this.scaleChanged,this.scale.val=1,i()},Ops.Gl.Matrix.Scale.prototype=new Op,Ops.Gl.Matrix.LookatCamera=function(){Op.apply(this,arguments);var e=this;this.name="LookatCamera",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.centerX=this.addInPort(new Port(this,"centerX")),this.centerY=this.addInPort(new Port(this,"centerY")),this.centerZ=this.addInPort(new Port(this,"centerZ")),this.eyeX=this.addInPort(new Port(this,"eyeX")),this.eyeY=this.addInPort(new Port(this,"eyeY")),this.eyeZ=this.addInPort(new Port(this,"eyeZ")),this.vecUpX=this.addInPort(new Port(this,"upX")),this.vecUpY=this.addInPort(new Port(this,"upY")),this.vecUpZ=this.addInPort(new Port(this,"upZ")),this.centerX.val=0,this.centerY.val=0,this.centerZ.val=0,this.eyeX.val=5,this.eyeY.val=5,this.eyeZ.val=5,this.vecUpX.val=0,this.vecUpY.val=1,this.vecUpZ.val=0;var t=vec3.create(),r=vec3.create(),n=vec3.create(),i=mat4.create();mat4.identity(i),this.render.onTriggered=function(){cgl.pushMvMatrix(),vec3.set(t,e.vecUpX.val,e.vecUpY.val,e.vecUpZ.val),vec3.set(r,e.eyeX.val,e.eyeY.val,e.eyeZ.val),vec3.set(n,e.centerX.val,e.centerY.val,e.centerZ.val),mat4.lookAt(cgl.mvMatrix,r,n,t),e.trigger.trigger(),cgl.popMvMatrix()}},Ops.Gl.Matrix.LookatCamera.prototype=new Op,Ops.Gl.Matrix.Shear=function(){function e(){mat4.identity(r),r[1]=Math.tan(t.shearX.val),r[4]=Math.tan(t.shearY.val)}Op.apply(this,arguments);var t=this;this.name="Shear",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.shearX=this.addInPort(new Port(this,"shearX")),this.shearY=this.addInPort(new Port(this,"shearY"));var r=mat4.create();this.shearY.onValueChanged=e,this.shearX.onValueChanged=e,this.render.onTriggered=function(){cgl.pushMvMatrix(),mat4.multiply(cgl.mvMatrix,cgl.mvMatrix,r),t.trigger.trigger(),cgl.popMvMatrix()},t.shearX.val=0,t.shearY.val=0},Ops.Gl.Matrix.Shear.prototype=new Op,Ops.Gl.Matrix.Transform=function(){Op.apply(this,arguments);var e=this;this.name="transform",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.posX=this.addInPort(new Port(this,"posX")),this.posY=this.addInPort(new Port(this,"posY")),this.posZ=this.addInPort(new Port(this,"posZ")),this.scaleX=this.addInPort(new Port(this,"scaleX")),this.scaleY=this.addInPort(new Port(this,"scaleY")),this.scaleZ=this.addInPort(new Port(this,"scaleZ")),this.rotX=this.addInPort(new Port(this,"rotX")),this.rotY=this.addInPort(new Port(this,"rotY")),this.rotZ=this.addInPort(new Port(this,"rotZ"));var t=vec3.create(),r=vec3.create(),n=mat4.create();mat4.identity(n);var i=!1,a=!1;this.render.onTriggered=function(){cgl.pushMvMatrix(),mat4.multiply(cgl.mvMatrix,cgl.mvMatrix,n),e.trigger.trigger(),cgl.popMvMatrix()};var o=function(){mat4.identity(n),a&&mat4.translate(n,n,t),0!==e.rotX.val&&mat4.rotateX(n,n,e.rotX.val*CGL.DEG2RAD),0!==e.rotY.val&&mat4.rotateY(n,n,e.rotY.val*CGL.DEG2RAD),0!==e.rotZ.val&&mat4.rotateZ(n,n,e.rotZ.val*CGL.DEG2RAD),i&&mat4.scale(n,n,r)};this.translateChanged=function(){a=!1,(0!==e.posX.val||0!==e.posY.val||0!==e.posZ.val)&&(a=!0),vec3.set(t,e.posX.val,e.posY.val,e.posZ.val),o()},this.scaleChanged=function(){i=!1,(0!==e.scaleX.val||0!==e.scaleY.val||0!==e.scaleZ.val)&&(i=!0),vec3.set(r,e.scaleX.val,e.scaleY.val,e.scaleZ.val),o()},this.rotChanged=function(){o()},this.rotX.onValueChanged=this.rotChanged,this.rotY.onValueChanged=this.rotChanged,this.rotZ.onValueChanged=this.rotChanged,this.scaleX.onValueChanged=this.scaleChanged,this.scaleY.onValueChanged=this.scaleChanged,this.scaleZ.onValueChanged=this.scaleChanged,this.posX.onValueChanged=this.translateChanged,this.posY.onValueChanged=this.translateChanged,this.posZ.onValueChanged=this.translateChanged,this.rotX.val=0,this.rotY.val=0,this.rotZ.val=0,this.scaleX.val=1,this.scaleY.val=1,this.scaleZ.val=1,this.posX.val=0,this.posY.val=0,this.posZ.val=0,o()},Ops.Gl.Matrix.Transform.prototype=new Op,Ops.RandomCluster=function(){function e(){t.randoms=[],t.randomsRot=[],t.randomsFloats=[];for(var e=0;e<t.num.val;e++)t.randomsFloats.push(Math.random()),t.randoms.push(vec3.fromValues((Math.random()-.5)*t.size.val,(Math.random()-.5)*t.size.val,(Math.random()-.5)*t.size.val)),t.randomsRot.push(vec3.fromValues(360*Math.random()*CGL.DEG2RAD,360*Math.random()*CGL.DEG2RAD,360*Math.random()*CGL.DEG2RAD))}Op.apply(this,arguments);var t=this;this.name="random cluster",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.num=this.addInPort(new Port(this,"num")),this.size=this.addInPort(new Port(this,"size")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.rnd=this.addOutPort(new Port(this,"rnd")),this.randoms=[],this.randomsRot=[],this.randomsFloats=[];vec3.create();this.exe.onTriggered=function(){for(var e=0;e<t.randoms.length;e++)cgl.pushMvMatrix(),mat4.translate(cgl.mvMatrix,cgl.mvMatrix,t.randoms[e]),mat4.rotateX(cgl.mvMatrix,cgl.mvMatrix,t.randomsRot[e][0]),mat4.rotateY(cgl.mvMatrix,cgl.mvMatrix,t.randomsRot[e][1]),mat4.rotateZ(cgl.mvMatrix,cgl.mvMatrix,t.randomsRot[e][2]),t.idx.val=e,t.rnd.val=t.randomsFloats[e],t.trigger.trigger(),cgl.popMvMatrix()},this.size.val=40,this.num.onValueChanged=e,this.size.onValueChanged=e,this.num.val=100},Ops.RandomCluster.prototype=new Op,Ops.Gl.Render2Texture=function(){function e(){cgl.gl.bindFramebuffer(cgl.gl.FRAMEBUFFER,i),n.width.val=cgl.getViewPort()[2],n.height.val=cgl.getViewPort()[3],l&&cgl.gl.deleteRenderbuffer(l),l=cgl.gl.createRenderbuffer(),cgl.gl.bindRenderbuffer(cgl.gl.RENDERBUFFER,l),cgl.gl.renderbufferStorage(cgl.gl.RENDERBUFFER,cgl.gl.DEPTH_COMPONENT16,n.width.val,n.height.val),cgl.gl.framebufferTexture2D(cgl.gl.FRAMEBUFFER,cgl.gl.COLOR_ATTACHMENT0,cgl.gl.TEXTURE_2D,a.tex,0),cgl.gl.framebufferRenderbuffer(cgl.gl.FRAMEBUFFER,cgl.gl.DEPTH_ATTACHMENT,cgl.gl.RENDERBUFFER,l),cgl.gl.framebufferTexture2D(cgl.gl.FRAMEBUFFER,cgl.gl.DEPTH_ATTACHMENT,cgl.gl.TEXTURE_2D,o.tex,0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,null),cgl.gl.bindRenderbuffer(cgl.gl.RENDERBUFFER,null),cgl.gl.bindFramebuffer(cgl.gl.FRAMEBUFFER,null),a.setSize(n.width.val,n.height.val),o.setSize(n.width.val,n.height.val)}function t(){if(cgl.pushMvMatrix(),cgl.gl.disable(cgl.gl.SCISSOR_TEST),n.useVPSize.val&&(a.width!=cgl.getViewPort()[2]||a.height!=cgl.getViewPort()[3])){console.log("not the same ? ",a.width,cgl.getViewPort()[2],a.height,cgl.getViewPort()[3]);for(var e=0;e<n.patch.ops.length;e++)n.patch.ops[e].onResize&&n.patch.ops[e].onResize()}cgl.gl.bindFramebuffer(cgl.gl.FRAMEBUFFER,i),cgl.pushPMatrix(),cgl.gl.viewport(0,0,n.width.val,n.height.val),cgl.gl.clearColor(0,0,0,0),cgl.gl.clear(cgl.gl.COLOR_BUFFER_BIT|cgl.gl.DEPTH_BUFFER_BIT),n.trigger.trigger(),cgl.popPMatrix(),cgl.gl.bindFramebuffer(cgl.gl.FRAMEBUFFER,null),cgl.popMvMatrix(),cgl.resetViewPort(),cgl.gl.enable(cgl.gl.SCISSOR_TEST)}function r(){t(),n.tex.val.preview()}Op.apply(this,arguments);{var n=this;cgl.gl.getExtension("WEBKIT_WEBGL_depth_texture")||cgl.gl.getExtension("MOZ_WEBGL_depth_texture")}this.name="render to texture",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var i,a=new CGL.Texture,o=new CGL.Texture({isDepthTexture:!0});this.useVPSize=this.addInPort(new Port(this,"use viewport size",OP_PORT_TYPE_VALUE,{display:"bool"})),this.width=this.addInPort(new Port(this,"texture width")),this.height=this.addInPort(new Port(this,"texture height")),this.tex=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.texDepth=this.addOutPort(new Port(this,"textureDepth",OP_PORT_TYPE_TEXTURE));var l=null;i=cgl.gl.createFramebuffer(),n.tex.val=a,n.texDepth.val=o,this.useVPSize.onValueChanged=function(){n.useVPSize.val?(n.width.onValueChanged=null,n.height.onValueChanged=null):(n.width.onValueChanged=e,n.height.onValueChanged=e)},this.width.val=1920,this.height.val=1080,this.useVPSize.val=!0;this.onResize=e,this.tex.onPreviewChanged=function(){n.render.onTriggered=n.tex.showPreview?r:t},n.render.onTriggered=t},Ops.Gl.Render2Texture.prototype=new Op,Ops.Gl.Spray=function(){function e(){this.pos=null,this.startPos=null,this.startTime=0,this.lifeTime=0,this.lifeTimePercent=0,this.endTime=0,this.pos=[0,0,0],this.moveVec=[0,0,0],this.idDead=!1,this.update=function(e){var t=e-this.startTime;e>this.endTime&&(this.isDead=!0),this.lifeTimePercent=t/this.lifeTime,this.pos=vec3.fromValues(this.startPos[0]+t*this.moveVec[0],this.startPos[1]+t*this.moveVec[1],this.startPos[2]+t*this.moveVec[2])},this.reAnimate=function(e){this.isDead=!1,this.startTime=e,this.lifeTime=Math.random()*r.lifetime.val,this.endTime=e+this.lifeTime,this.startPos=vec3.fromValues(.5*Math.random(),.5*Math.random(),.5*Math.random()),this.moveVec=[.2*Math.random(),.2*Math.random(),.2*Math.random()]},this.reAnimate(0)}function t(){n.length=0;for(var t=0;t<r.num.val;t++){var i=new e;i.reAnimate(0),n.push(i)}}Op.apply(this,arguments);var r=this;this.name="spray",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.timer=this.addInPort(new Port(this,"time")),this.num=this.addInPort(new Port(this,"num")),this.size=this.addInPort(new Port(this,"size")),this.lifetime=this.addInPort(new Port(this,"lifetime")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.lifeTimePercent=this.addOutPort(new Port(this,"lifeTimePercent"));{var n=[];vec3.create()}this.exe.onTriggered=function(){for(var e=r.timer.val,t=0;t<n.length;t++)n[t].isDead&&n[t].reAnimate(e),n[t].update(e),cgl.pushMvMatrix(),mat4.translate(cgl.mvMatrix,cgl.mvMatrix,n[t].pos),r.idx.val=t,r.lifeTimePercent.val=n[t].lifeTimePercent,r.trigger.trigger(),cgl.popMvMatrix()},this.num.onValueChanged=t,this.size.onValueChanged=t,this.lifetime.onValueChanged=t,this.num.val=100,t()},Ops.Gl.Spray.prototype=new Op,Ops.Gl.Identity=function(){Op.apply(this,arguments);var e=this;this.name="Identity",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){cgl.pushMvMatrix(),mat4.identity(cgl.mvMatrix),mat4.perspective(cgl.pMatrix,45,cgl.canvasWidth/cgl.canvasHeight,.01,1100),e.trigger.trigger(),cgl.popMvMatrix()}},Ops.Gl.Identity.prototype=new Op,Ops.Gl.CanvasSize=function(){Op.apply(this,arguments);var e=this;this.name="CanvasSize",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.width=this.addOutPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addOutPort(new Port(this,"height",OP_PORT_TYPE_VALUE));var t=0,r=0;this.exe.onTriggered=function(){cgl.canvasHeight!=r&&(r=e.height.val=cgl.canvasHeight),cgl.canvasWidth!=t&&(t=e.width.val=cgl.canvasWidth),e.trigger.trigger()}},Ops.Gl.CanvasSize.prototype=new Op,Ops.Gl.ViewPortSize=function(){Op.apply(this,arguments);var e=this;this.name="ViewPortSize",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.x=this.addOutPort(new Port(this,"x",OP_PORT_TYPE_VALUE)),this.y=this.addOutPort(new Port(this,"y",OP_PORT_TYPE_VALUE)),this.width=this.addOutPort(new Port(this,"width",OP_PORT_TYPE_VALUE)),this.height=this.addOutPort(new Port(this,"height",OP_PORT_TYPE_VALUE));var t=0,r=0,n=0,i=0;this.exe.onTriggered=function(){cgl.getViewPort()[0]!=n&&(t=e.x.val=cgl.getViewPort()[0]),cgl.getViewPort()[1]!=i&&(r=e.y.val=cgl.getViewPort()[1]),cgl.getViewPort()[2]!=r&&(r=e.width.val=cgl.getViewPort()[2]),cgl.getViewPort()[3]!=t&&(t=e.height.val=cgl.getViewPort()[3]),e.trigger.trigger()}},Ops.Gl.ViewPortSize.prototype=new Op,Ops.Gl.Performance=function(){function e(){p=performance.now();var e=performance.now()-h;if(u.push(e),u.shift(),l++,0===d&&(d=Date.now()),Date.now()-d>=1e3){s=l,l=0,o="fps: "+s,d=Date.now();for(var n=0,g=0;g<u.length;g++)u[g]>-1&&(c+=u[g],n++);c/=n,P="avg ms: "+Math.round(100*c)/100+" ("+Math.round(100*f)/100+")"}a.clearRect(0,0,r.width,r.height),a.fillStyle="#222222",a.fillRect(0,0,r.width,r.height),a.fillStyle="#aaaaaa";for(var g=0;512>g;g++)a.fillRect(g,r.height-u[g],1,u[g]);a.fillText(o,10,20),a.fillText(P,10,35),a.restore(),t.textureOut.val?t.textureOut.val.initTexture(i):t.textureOut.val=new CGL.Texture.fromImage(i),h=performance.now(),f=performance.now()-p,t.trigger.trigger()}Op.apply(this,arguments);var t=this;this.name="Performance",this.textureOut=this.addOutPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var r=document.createElement("canvas");r.id="performance",r.width=512,r.height=128,r.style.display="block";var n=document.getElementsByTagName("body")[0];n.appendChild(r);var i=document.getElementById("performance"),a=i.getContext("2d"),o="";a.font="13px arial",a.fillStyle="white";for(var l=0,s=0,d=0,h=0,u=[],g=0;g<r.width;g++)u[g]=-1;var c=0,P="",p=0,f=0;t.exe.onTriggered=e,CABLES.UI&&gui.setLayout()},Ops.Gl.Performance.prototype=new Op,Ops.Gl.Shader=Ops.Gl.Shader||{},Ops.Gl.Shader.ShowNormalsMaterial=function(){Op.apply(this,arguments);var e=this;this.name="ShowNormalsMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){cgl.setShader(r),e.trigger.trigger(),cgl.setPreviousShader()};var t="".endl()+"precision highp float;".endl()+"varying vec3 norm;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(norm.x,norm.y,norm.z,1.0);".endl()+"   gl_FragColor = col;".endl()+"}",r=new CGL.Shader;this.onLoaded=r.compile,r.setSource(r.getDefaultVertexShader(),t),this.render.onTriggered=this.doRender,this.doRender()},Ops.Gl.Shader.ShowNormalsMaterial.prototype=new Op,Ops.Gl.Shader.SphereEnvMaterial=function(){Op.apply(this,arguments);var e=this;this.name="SphereEnvMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.texture=this.addInPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.textureUniform=null,this.texture.onValueChanged=function(){if(e.texture.val){if(null!==e.textureUniform)return;n.removeUniform("tex"),e.textureUniform=new CGL.Uniform(n,"t","tex",0)}else console.log("TEXTURE REMOVED"),n.removeUniform("tex"),e.textureUniform=null},this.doRender=function(){cgl.setShader(n),e.texture.val&&(cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.texture.val.tex)),e.trigger.trigger(),cgl.setPreviousShader()};var t="".endl()+"precision mediump float;".endl()+"attribute vec3 vPosition;".endl()+"attribute vec2 attrTexCoord;".endl()+"attribute vec3 attrVertNormal;".endl()+"varying vec2 texCoord;".endl()+"varying vec3 norm;".endl()+"uniform mat4 projMatrix;".endl()+"uniform mat4 mvMatrix;".endl()+"uniform mat4 normalMatrix;".endl()+"varying vec2 vNorm;".endl()+"".endl()+"void main()".endl()+"{".endl()+"    texCoord=attrTexCoord;".endl()+"    norm=attrVertNormal;".endl()+"".endl()+"    vec4 pos = vec4( vPosition, 1. );".endl()+"    vec3 e = normalize( vec3( mvMatrix * pos ) );".endl()+"    vec3 n = normalize( mat3(normalMatrix) * norm );".endl()+"".endl()+"    vec3 r = reflect( e, n );".endl()+"    float m = 2. * sqrt( ".endl()+"        pow(r.x, 2.0)+".endl()+"        pow(r.y, 2.0)+".endl()+"        pow(r.z + 1.0, 2.0)".endl()+"    );".endl()+"    vNorm = r.xy / m + 0.5;".endl()+"".endl()+"    gl_Position = projMatrix * mvMatrix * pos;".endl()+"}",r="".endl()+"precision mediump float;".endl()+"varying vec3 norm;".endl()+"varying vec2 texCoord;".endl()+"uniform sampler2D tex;".endl()+"".endl()+"varying vec2 vNorm;".endl()+"".endl()+"void main()".endl()+"{".endl()+"    vec4 col = texture2D( tex, vNorm );".endl()+"    gl_FragColor = col;".endl()+"".endl()+"}",n=new CGL.Shader;this.onLoaded=n.compile,n.setSource(t,r),this.render.onTriggered=this.doRender,this.doRender(),this.uiAttribs.warning='"SphereEnvMaterial" is deprecated, please use "matcap"'},Ops.Gl.Shader.SphereEnvMaterial.prototype=new Op,Ops.Gl.Shader.MatCapMaterial=function(){Op.apply(this,arguments);var e=this;this.name="MatCapMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.texture=this.addInPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.textureUniform=null,this.texture.onValueChanged=function(){if(e.texture.val){if(null!==e.textureUniform)return;n.removeUniform("tex"),e.textureUniform=new CGL.Uniform(n,"t","tex",0)}else console.log("TEXTURE REMOVED"),n.removeUniform("tex"),e.textureUniform=null},this.doRender=function(){cgl.setShader(n),e.texture.val&&(cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.texture.val.tex)),e.trigger.trigger(),
cgl.setPreviousShader()};var t="".endl()+"precision mediump float;".endl()+"attribute vec3 vPosition;".endl()+"attribute vec2 attrTexCoord;".endl()+"attribute vec3 attrVertNormal;".endl()+"varying vec2 texCoord;".endl()+"varying vec3 norm;".endl()+"uniform mat4 projMatrix;".endl()+"uniform mat4 mvMatrix;".endl()+"uniform mat4 normalMatrix;".endl()+"varying vec2 vNorm;".endl()+"".endl()+"void main()".endl()+"{".endl()+"    texCoord=attrTexCoord;".endl()+"    norm=attrVertNormal;".endl()+"".endl()+"    vec4 pos = vec4( vPosition, 1. );".endl()+"    vec3 e = normalize( vec3( mvMatrix * pos ) );".endl()+"    vec3 n = normalize( mat3(normalMatrix) * norm );".endl()+"".endl()+"    vec3 r = reflect( e, n );".endl()+"    float m = 2. * sqrt( ".endl()+"        pow(r.x, 2.0)+".endl()+"        pow(r.y, 2.0)+".endl()+"        pow(r.z + 1.0, 2.0)".endl()+"    );".endl()+"    vNorm = r.xy / m + 0.5;".endl()+"".endl()+"    gl_Position = projMatrix * mvMatrix * pos;".endl()+"}",r="".endl()+"precision mediump float;".endl()+"varying vec3 norm;".endl()+"varying vec2 texCoord;".endl()+"uniform sampler2D tex;".endl()+"".endl()+"varying vec2 vNorm;".endl()+"".endl()+"void main()".endl()+"{".endl()+"    vec4 col = texture2D( tex, vNorm );".endl()+"    gl_FragColor = col;".endl()+"".endl()+"}",n=new CGL.Shader;this.onLoaded=n.compile,n.setSource(t,r),this.render.onTriggered=this.doRender,this.doRender()},Ops.Gl.Shader.MatCapMaterial.prototype=new Op,Ops.Gl.Shader.GradientMaterial=function(){Op.apply(this,arguments);var e=this;this.name="GradientMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.r=this.addInPort(new Port(this,"r1",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g1",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b1",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a1",OP_PORT_TYPE_VALUE,{display:"range"})),this.r2=this.addInPort(new Port(this,"r2",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g2=this.addInPort(new Port(this,"g2",OP_PORT_TYPE_VALUE,{display:"range"})),this.b2=this.addInPort(new Port(this,"b2",OP_PORT_TYPE_VALUE,{display:"range"})),this.a2=this.addInPort(new Port(this,"a2",OP_PORT_TYPE_VALUE,{display:"range"})),this.r3=this.addInPort(new Port(this,"r3",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g3=this.addInPort(new Port(this,"g3",OP_PORT_TYPE_VALUE,{display:"range"})),this.b3=this.addInPort(new Port(this,"b3",OP_PORT_TYPE_VALUE,{display:"range"})),this.a3=this.addInPort(new Port(this,"a3",OP_PORT_TYPE_VALUE,{display:"range"})),this.r.val=.2,this.g.val=.2,this.b.val=.2,this.a.val=1,this.r2.val=.73,this.g2.val=.73,this.b2.val=.73,this.a2.val=1,this.r3.val=1,this.g3.val=1,this.b3.val=1,this.a3.val=1;var t=[],r=[],n=[];this.doRender=function(){cgl.setShader(a),e.trigger.trigger(),cgl.setPreviousShader()};var i="".endl()+"precision highp float;".endl()+"varying vec3 norm;".endl()+"varying vec2 texCoord;".endl()+"uniform vec4 colA;".endl()+"uniform vec4 colB;".endl()+"uniform vec4 colC;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   if(texCoord.y<=0.5)".endl()+"   {".endl()+"       gl_FragColor = vec4(mix(colA, colB, texCoord.y*2.0));".endl()+"   }".endl()+"   if(texCoord.y>0.5)".endl()+"   {".endl()+"       gl_FragColor = vec4(mix(colB, colC, (texCoord.y-0.5)*2.0));".endl()+"   }".endl()+"}",a=new CGL.Shader;this.onLoaded=a.compile,a.setSource(a.getDefaultVertexShader(),i),this.doRender(),this.r.onValueChanged=this.g.onValueChanged=this.b.onValueChanged=this.a.onValueChanged=function(){t=[e.r.val,e.g.val,e.b.val,e.a.val],e.r.uniform?e.r.uniform.setValue(t):e.r.uniform=new CGL.Uniform(a,"4f","colA",t)},this.r2.onValueChanged=this.g2.onValueChanged=this.b2.onValueChanged=this.a2.onValueChanged=function(){r=[e.r2.val,e.g2.val,e.b2.val,e.a2.val],e.r2.uniform?e.r2.uniform.setValue(r):e.r2.uniform=new CGL.Uniform(a,"4f","colB",r)},this.r3.onValueChanged=this.g3.onValueChanged=this.b3.onValueChanged=this.a3.onValueChanged=function(){n=[e.r3.val,e.g3.val,e.b3.val,e.a3.val],e.r3.uniform?e.r3.uniform.setValue(n):e.r3.uniform=new CGL.Uniform(a,"4f","colC",n)},this.r3.onValueChanged(),this.r2.onValueChanged(),this.r.onValueChanged(),this.render.onTriggered=this.doRender},Ops.Gl.Shader.GradientMaterial.prototype=new Op,Ops.Gl.Shader.BasicMaterial=function(){Op.apply(this,arguments);var e=this;this.name="BasicMaterial",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){cgl.setShader(n),e.texture.val&&(cgl.gl.activeTexture(cgl.gl.TEXTURE0),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.texture.val.tex)),e.textureOpacity.val&&(cgl.gl.activeTexture(cgl.gl.TEXTURE1),cgl.gl.bindTexture(cgl.gl.TEXTURE_2D,e.textureOpacity.val.tex)),e.trigger.trigger(),cgl.setPreviousShader()};var t="".endl()+"attribute vec3 vPosition;".endl()+"attribute vec2 attrTexCoord;".endl()+"attribute vec3 attrVertNormal;".endl()+"varying vec2 texCoord;".endl()+"varying vec3 norm;".endl()+"uniform mat4 projMatrix;".endl()+"uniform mat4 mvMatrix;".endl()+"uniform mat4 normalMatrix;".endl()+"void main()".endl()+"{".endl()+"   texCoord=attrTexCoord;".endl()+"   norm=attrVertNormal;".endl()+"#ifdef BILLBOARD".endl()+"   vec3 position=vPosition;".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(( ".endl()+"       position.x * vec3(".endl()+"           mvMatrix[0][0],".endl()+"           mvMatrix[1][0], ".endl()+"           mvMatrix[2][0] ) +".endl()+"       position.y * vec3(".endl()+"           mvMatrix[0][1],".endl()+"           mvMatrix[1][1], ".endl()+"           mvMatrix[2][1]) ), 1.0);".endl()+"#endif ".endl()+"".endl()+"#ifndef BILLBOARD".endl()+"   gl_Position = projMatrix * mvMatrix * vec4(vPosition,  1.0);".endl()+"#endif ".endl()+"}",r="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"   varying vec2 texCoord;".endl()+"   #ifdef HAS_TEXTURE_DIFFUSE".endl()+"       uniform sampler2D tex;".endl()+"   #endif".endl()+"   #ifdef HAS_TEXTURE_OPACITY".endl()+"       uniform sampler2D texOpacity;".endl()+"   #endif".endl()+"#endif".endl()+"uniform float r;".endl()+"uniform float g;".endl()+"uniform float b;".endl()+"uniform float a;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(r,g,b,a);".endl()+"   #ifdef HAS_TEXTURES".endl()+"      #ifdef HAS_TEXTURE_DIFFUSE".endl()+"          col=texture2D(tex,texCoord);".endl()+"           #ifdef COLORIZE_TEXTURE".endl()+"               col.r*=r;".endl()+"               col.g*=g;".endl()+"               col.b*=b;".endl()+"           #endif".endl()+"      #endif".endl()+"      #ifdef HAS_TEXTURE_OPACITY".endl()+"          col.a*=texture2D(texOpacity,texCoord).g;".endl()+"       #endif".endl()+"       col.a*=a;".endl()+"   #endif".endl()+"   gl_FragColor = col;".endl()+"}",n=new CGL.Shader;this.onLoaded=n.compile,n.setSource(t,r),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.r.onValueChanged=function(){e.r.uniform?e.r.uniform.setValue(e.r.val):e.r.uniform=new CGL.Uniform(n,"f","r",e.r.val)},this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.g.onValueChanged=function(){e.g.uniform?e.g.uniform.setValue(e.g.val):e.g.uniform=new CGL.Uniform(n,"f","g",e.g.val)},this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.b.onValueChanged=function(){e.b.uniform?e.b.uniform.setValue(e.b.val):e.b.uniform=new CGL.Uniform(n,"f","b",e.b.val)},this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.a.onValueChanged=function(){e.a.uniform?e.a.uniform.setValue(e.a.val):e.a.uniform=new CGL.Uniform(n,"f","a",e.a.val)},this.r.val=Math.random(),this.g.val=Math.random(),this.b.val=Math.random(),this.a.val=1,this.render.onTriggered=this.doRender,this.texture=this.addInPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.textureUniform=null,this.texture.onPreviewChanged=function(){e.render.onTriggered=e.texture.showPreview?e.texture.val.preview:e.doRender,console.log("show preview!")},this.texture.onValueChanged=function(){if(e.texture.val){if(null!==e.textureUniform)return;console.log("TEXTURE ADDED"),n.removeUniform("tex"),n.define("HAS_TEXTURE_DIFFUSE"),e.textureUniform=new CGL.Uniform(n,"t","tex",0)}else console.log("TEXTURE REMOVED"),n.removeUniform("tex"),n.removeDefine("HAS_TEXTURE_DIFFUSE"),e.textureUniform=null},this.textureOpacity=this.addInPort(new Port(this,"textureOpacity",OP_PORT_TYPE_TEXTURE,{preview:!0})),this.textureOpacityUniform=null,this.textureOpacity.onPreviewChanged=function(){e.render.onTriggered=e.textureOpacity.showPreview?e.textureOpacity.val.preview:e.doRender,console.log("show preview!")},this.textureOpacity.onValueChanged=function(){if(e.textureOpacity.val){if(null!==e.textureOpacityUniform)return;console.log("TEXTURE OPACITY ADDED"),n.removeUniform("texOpacity"),n.define("HAS_TEXTURE_OPACITY"),e.textureOpacityUniform=new CGL.Uniform(n,"t","texOpacity",1)}else console.log("TEXTURE OPACITY REMOVED"),n.removeUniform("texOpacity"),n.removeDefine("HAS_TEXTURE_OPACITY"),e.textureOpacityUniform=null},this.colorizeTexture=this.addInPort(new Port(this,"colorizeTexture",OP_PORT_TYPE_VALUE,{display:"bool"})),this.colorizeTexture.val=!1,this.colorizeTexture.onValueChanged=function(){1==e.colorizeTexture.val?n.define("COLORIZE_TEXTURE"):n.removeDefine("COLORIZE_TEXTURE")},this.doBillboard=this.addInPort(new Port(this,"billboard",OP_PORT_TYPE_VALUE,{display:"bool"})),this.doBillboard.val=!1,this.doBillboard.onValueChanged=function(){e.doBillboard.val?n.define("BILLBOARD"):n.removeDefine("BILLBOARD")},this.doRender()},Ops.Gl.Shader.BasicMaterial.prototype=new Op,Ops.Gl.Shader.TextureSinusWobble=function(){Op.apply(this,arguments);var e=this;this.name="texture sinus wobble",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.doRender=function(){cgl.setShader(r),e.texture.val&&(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,e.texture.val.tex)),e.trigger.trigger(),cgl.setPreviousShader()};var t="".endl()+"precision highp float;".endl()+"#ifdef HAS_TEXTURES".endl()+"   varying vec2 texCoord;".endl()+"   #ifdef HAS_TEXTURE_DIFFUSE".endl()+"       uniform sampler2D tex;".endl()+"   #endif".endl()+"#endif".endl()+"uniform float a;".endl()+"uniform float time;".endl()+"".endl()+"void main()".endl()+"{".endl()+"   vec4 col=vec4(1,1,1,a);".endl()+"   #ifdef HAS_TEXTURES".endl()+"      #ifdef HAS_TEXTURE_DIFFUSE".endl()+"           float x=texCoord.x+sin(time+texCoord.y*(3.0))*0.15 ;".endl()+"           float y=texCoord.y+sin(time+texCoord.x*(3.0))*0.15 ;".endl()+"           vec2 tc=vec2(x,y );".endl()+"          col=texture2D(tex,tc);".endl()+"      #endif".endl()+"       col.a*=a;".endl()+"   #endif".endl()+"gl_FragColor = col;".endl()+"}",r=new CGL.Shader;this.onLoaded=r.compile,r.setSource(r.getDefaultVertexShader(),t),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.a.onValueChanged=function(){e.a.uniform?e.a.uniform.setValue(e.a.val):e.a.uniform=new CGL.Uniform(r,"f","a",e.a.val)},this.a.val=1,this.time=this.addInPort(new Port(this,"time",OP_PORT_TYPE_VALUE,{})),this.time.onValueChanged=function(){e.time.uniform?e.time.uniform.setValue(e.time.val):e.time.uniform=new CGL.Uniform(r,"f","time",e.a.val)},this.time.val=1,this.render.onTriggered=this.doRender,this.texture=this.addInPort(new Port(this,"texture",OP_PORT_TYPE_TEXTURE)),this.textureUniform=null,this.texture.onValueChanged=function(){if(e.texture.val){if(null!==e.textureUniform)return;console.log("TEXTURE ADDED"),r.removeUniform("tex"),r.define("HAS_TEXTURE_DIFFUSE"),e.textureUniform=new CGL.Uniform(r,"t","tex",0)}else console.log("TEXTURE REMOVED"),r.removeUniform("tex"),r.removeDefine("HAS_TEXTURE_DIFFUSE"),e.textureUniform=null},this.doRender()},Ops.Gl.Shader.TextureSinusWobble.prototype=new Op,Ops.Gl.Meshes=Ops.Gl.Meshes||{},Ops.Gl.Meshes.Triangle=function(){Op.apply(this,arguments);var e=this;this.name="Triangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){e.mesh.render(cgl.getShader()),e.trigger.trigger()};var t=new CGL.Geometry;t.vertices=[0,1,0,-1,-1,0,1,-1,0],t.verticesIndices=[0,1,2],this.mesh=new CGL.Mesh(t)},Ops.Gl.Meshes.Triangle.prototype=new Op,Ops.Gl.Meshes.Rectangle=function(){function e(){r.vertices=[t.width.val/2,t.height.val/2,0,-t.width.val/2,t.height.val/2,0,t.width.val/2,-t.height.val/2,0,-t.width.val/2,-t.height.val/2,0],r.texCoords=[1,1,0,1,1,0,0,0],r.verticesIndices=[0,1,2,3,1,2],t.mesh||(t.mesh=new CGL.Mesh(r)),t.mesh.setGeom(r)}Op.apply(this,arguments);var t=this;this.name="rectangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.width=this.addInPort(new Port(this,"width")),this.height=this.addInPort(new Port(this,"height")),this.width.val=1,this.height.val=1,this.render.onTriggered=function(){t.mesh.render(cgl.getShader()),t.trigger.trigger()};var r=new CGL.Geometry;this.mesh=null,e(),this.width.onValueChanged=e,this.height.onValueChanged=e},Ops.Gl.Meshes.Rectangle.prototype=new Op,Ops.Gl.Meshes.FullscreenRectangle=function(){function e(){var e=cgl.getViewPort().slice();n=e[0],i=e[1],a=e[2],h=e[3];var o=0,l=0;r.vertices=[o+a,l+h,0,o,l+h,0,o+a,l,0,o,l,0],r.texCoords=[1,0,0,0,1,1,0,1],r.verticesIndices=[0,1,2,3,1,2],t.mesh?t.mesh.setGeom(r):t.mesh=new CGL.Mesh(r)}Op.apply(this,arguments);var t=this;this.name="fullscreen rectangle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.mesh=null;var r=new CGL.Geometry,n=0,i=0,a=0;this.render.onTriggered=function(){(cgl.getViewPort()[2]!=a||cgl.getViewPort()[3]!=h)&&e(),cgl.pushPMatrix(),mat4.identity(cgl.pMatrix),mat4.ortho(cgl.pMatrix,0,a,h,0,-10,1e3),cgl.pushMvMatrix(),mat4.identity(cgl.mvMatrix),t.mesh.render(cgl.getShader()),cgl.gl.clear(cgl.gl.DEPTH_BUFFER_BIT),cgl.popPMatrix(),cgl.popMvMatrix(),t.trigger.trigger()},this.onResize=this.rebuild},Ops.Gl.Meshes.FullscreenRectangle.prototype=new Op,Ops.Gl.Meshes.Circle=function(){function e(){r.clear();var e=0,i=0,a=0,o=0,l=0,s=0,d=0,h=0,u=0,g=0,c=0,P=0,p=0,f=0;if(t.innerRadius.val<=0)for(e=0;e<=t.segments.val*t.percent.val;e++)i=360/t.segments.val*e*CGL.DEG2RAD,p=Math.cos(i)*t.radius.val,f=Math.sin(i)*t.radius.val,c=(Math.cos(i)+1)/2,P=(Math.sin(i)+1)/2,r.addFace([p,f,0],[a,o,0],[0,0,0]),r.texCoords.push(c,P,l,s,.5,.5),l=c,s=P,a=p,o=f;else{var v=0;for(e=0;e<=t.segments.val*t.percent.val;e++){v++,i=360/t.segments.val*e*CGL.DEG2RAD,p=Math.cos(i)*t.radius.val,f=Math.sin(i)*t.radius.val;var m=Math.cos(i)*t.innerRadius.val*t.radius.val,T=Math.sin(i)*t.innerRadius.val*t.radius.val;c=(Math.cos(i)+1)/2,P=(Math.sin(i)+1)/2;var O=(Math.cos(i)+1)/2*t.innerRadius.val,_=(Math.sin(i)+1)/2*t.innerRadius.val;(0===t.steps.val||v%parseInt(t.steps.val,10)===0&&!t.invertSteps.val||v%parseInt(t.steps.val,10)!==0&&t.invertSteps.val)&&(r.addFace([p,f,0],[a,o,0],[m,T,0]),r.addFace([m,T,0],[a,o,0],[d,h,0]),r.texCoords.push(c,P,l,s,O,_),r.texCoords.push(O,_,l,s,u,g)),u=O,g=_,l=c,s=P,a=p,o=f,d=m,h=T}}n.setGeom(r)}Op.apply(this,arguments);var t=this;this.name="Circle",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.segments=this.addInPort(new Port(this,"segments")),this.radius=this.addInPort(new Port(this,"radius")),this.innerRadius=this.addInPort(new Port(this,"innerRadius",OP_PORT_TYPE_VALUE,{display:"range"})),this.percent=this.addInPort(new Port(this,"percent")),this.steps=this.addInPort(new Port(this,"steps",OP_PORT_TYPE_VALUE,{type:"int"})),this.steps.val=0,this.invertSteps=this.addInPort(new Port(this,"invertSteps",OP_PORT_TYPE_VALUE,{display:"bool"})),this.invertSteps.val=!1,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.render.onTriggered=function(){n.render(cgl.getShader()),t.trigger.trigger()},this.segments.val=40,this.radius.val=1,this.innerRadius.val=0,this.percent.val=1;var r=new CGL.Geometry,n=new CGL.Mesh(r);this.segments.onValueChanged=e,this.radius.onValueChanged=e,this.innerRadius.onValueChanged=e,this.percent.onValueChanged=e,this.steps.onValueChanged=e,this.invertSteps.onValueChanged=e,e()},Ops.Gl.Meshes.Circle.prototype=new Op,Ops.Gl.Meshes.ObjMesh=function(){Op.apply(this,arguments);var e=this;this.name="OBJ Mesh",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.filename=this.addInPort(new Port(this,"file",OP_PORT_TYPE_VALUE,{display:"file",filter:"mesh"})),this.mesh=null,this.render.onTriggered=function(){e.mesh&&e.mesh.render(cgl.getShader()),e.trigger.trigger()},this.filename.onValueChanged=function(){CGL.incrementLoadingAssets(),ajaxRequest(e.filename.val,function(t){var r=parseOBJ(t);unwrap=function(e,t,r){for(var n=new Array(Math.floor(e.length/3)*r),i=0;i<e.length;i++)for(var a=0;r>a;a++)n[i*r+a]=t[e[i]*r+a];return n};var n=r.verticesIndices.length;r.vertices=unwrap(r.verticesIndices,r.vertices,3),r.texCoords=unwrap(r.texCoordsIndices,r.texCoords,2),r.vertexNormals=unwrap(r.vertexNormalIndices,r.vertexNormals,3),r.verticesIndices=[];for(var i=0;n>i;i++)r.verticesIndices.push(i);e.mesh=new CGL.Mesh(r),CGL.decrementLoadingAssets()})}},Ops.Gl.Meshes.ObjMesh.prototype=new Op,Ops.Gl.Meshes.Cube=function(){Op.apply(this,arguments);var e=this;this.name="Cube",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.mesh=null,this.render.onTriggered=function(){null!==e.mesh&&e.mesh.render(cgl.getShader()),e.trigger.trigger()};var t=new CGL.Geometry;t.vertices=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],t.texCoords=[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],t.vertexNormals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],t.verticesIndices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],this.mesh=new CGL.Mesh(t)},Ops.Gl.Meshes.Cube.prototype=new Op,Ops.Log=function(){Op.apply(this,arguments);var e=this;this.name="logger",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.input=this.addInPort(new Port(this,"input")),this.input.val="",this.exec=function(){console.log("[log] "+e.input.val)},this.exe.onTriggered=this.exec,this.input.onValueChanged=this.exec},Ops.Log.prototype=new Op,Ops.Profiler=function(){Op.apply(this,arguments);var e=this;this.name="Profiler",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.input=this.addInPort(new Port(this,"input")),this.input.val="",this.exec=function(){console.log("[log] "+e.input.val)},this.exe.onTriggered=this.exec,this.input.onValueChanged=this.exec},Ops.Profiler.prototype=new Op,Ops.CallsPerSecond=function(){Op.apply(this,arguments);var e=this;this.name="CallsPerSecond",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.cps=this.addOutPort(new Port(this,"cps",OP_PORT_TYPE_VALUE)),this.timeStart=0,this.cpsCount=0,this.exe.onTriggered=function(){0===e.timeStart&&(e.timeStart=Date.now());var t=Date.now();t-e.timeStart>1e3&&(e.timeStart=Date.now(),e.cps.val=e.cpsCount,e.cpsCount=0),e.cpsCount++}},Ops.CallsPerSecond.prototype=new Op,Ops.Value=function(){Op.apply(this,arguments);var e=this;this.name="Value",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.v=this.addInPort(new Port(this,"value",OP_PORT_TYPE_VALUE)),this.result=this.addOutPort(new Port(this,"result")),this.v.onAnimToggle=function(){},this.exec=function(){e.result.val!=e.v.val&&(e.result.val=e.v.val)},this.exe.onTriggered=this.exec,this.v.onValueChanged=this.exec,this.onAnimFrame=function(){}},Ops.Value.prototype=new Op,Ops.ColorValue=function(){Op.apply(this,arguments);var e=this;this.name="ColorValue",this.g=this.addInPort(new Port(this,"ignore",OP_PORT_TYPE_FUNCTION,{display:"readonly"})),this.r=this.addInPort(new Port(this,"r",OP_PORT_TYPE_VALUE,{display:"range",colorPick:"true"})),this.g=this.addInPort(new Port(this,"g",OP_PORT_TYPE_VALUE,{display:"range"})),this.b=this.addInPort(new Port(this,"b",OP_PORT_TYPE_VALUE,{display:"range"})),this.a=this.addInPort(new Port(this,"a",OP_PORT_TYPE_VALUE,{display:"range"})),this.outR=this.addOutPort(new Port(this,"outr",OP_PORT_TYPE_VALUE)),this.outG=this.addOutPort(new Port(this,"outg",OP_PORT_TYPE_VALUE)),this.outB=this.addOutPort(new Port(this,"outb",OP_PORT_TYPE_VALUE)),this.outA=this.addOutPort(new Port(this,"outa",OP_PORT_TYPE_VALUE));var t=function(){e.outR.val=e.r.val,e.outG.val=e.g.val,e.outB.val=e.b.val,e.outA.val=e.a.val};this.r.onValueChanged=t,this.g.onValueChanged=t,this.b.onValueChanged=t,this.a.onValueChanged=t},Ops.ColorValue.prototype=new Op,Ops.TimeLineTime=function(){Op.apply(this,arguments);this.name="TimeLineTime",this.theTime=this.addOutPort(new Port(this,"time")),this.onAnimFrame=function(e){this.theTime.val=e}},Ops.TimeLineTime.prototype=new Op,Ops.TimeLineDelay=function(){Op.apply(this,arguments);var e=this;this.name="TimeLineDelay",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.theTime=this.addOutPort(new Port(this,"time")),this.delay=this.addInPort(new Port(this,"delay")),this.delay.val=0,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){e.patch.timer.pauseEvents(!0),e.patch.timer.setDelay(e.delay.val),e.theTime.val=e.patch.timer.getTime(),e.trigger.trigger(),e.patch.timer.setDelay(0),e.patch.timer.pauseEvents(!1)}},Ops.TimeLineDelay.prototype=new Op,Ops.TimeLineDelayFrames=function(){Op.apply(this,arguments);var e=this;this.name="TimeLineDelayFrames",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.theTime=this.addOutPort(new Port(this,"time")),this.delay=this.addInPort(new Port(this,"delay")),this.delay.val=0,this.fps=this.addInPort(new Port(this,"fps")),this.fps.val=30,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){e.patch.timer.setDelay(e.delay.val/e.fps.val),e.theTime.val=e.patch.timer.getTime(),e.trigger.trigger(),e.patch.timer.setDelay(0)}},Ops.TimeLineDelayFrames.prototype=new Op,Ops.TimeLineOverwrite=function(){Op.apply(this,arguments);var e=this;this.name="TimeLineOverwrite",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.newTime=this.addInPort(new Port(this,"new time")),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.theTime=this.addOutPort(new Port(this,"time")),this.newTime.val=0;var t=0;this.exe.onTriggered=function(){t=e.patch.timer.getTime(),e.patch.timer.overwriteTime=e.newTime.val,e.trigger.trigger(),e.patch.timer.overwriteTime=-1}},Ops.TimeLineOverwrite.prototype=new Op,Ops.Repeat=function(){Op.apply(this,arguments);var e=this;this.name="Repeat",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.num=this.addInPort(new Port(this,"num")),this.num.val=5,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.exe.onTriggered=function(){for(var t=e.num.value-1;t>-1;t--)e.idx.val=t,e.trigger.trigger()}},Ops.Repeat.prototype=new Op,Ops.ArrayIterator=function(){Op.apply(this,arguments);var e=this;this.name="ArrayIterator",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.arr=this.addInPort(new Port(this,"array",OP_PORT_TYPE_ARRAY)),this.num=this.addInPort(new Port(this,"num")),this.num.val=5,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.idx=this.addOutPort(new Port(this,"index")),this.val=this.addOutPort(new Port(this,"value")),this.exe.onTriggered=function(){if(e.arr.val)for(var t in e.arr.val)e.idx.val=t,e.val.val=e.arr.val[t],e.trigger.trigger()}},Ops.ArrayIterator.prototype=new Op,Ops.IfTrueThen=function(){Op.apply(this,arguments);var e=this;this.name="if true then",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.bool=this.addInPort(new Port(this,"boolean")),this.bool.val=!1,this.triggerThen=this.addOutPort(new Port(this,"then",OP_PORT_TYPE_FUNCTION)),this.triggerElse=this.addOutPort(new Port(this,"else",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){e.bool.val||e.bool.val>=1?e.triggerThen.trigger():e.triggerElse.trigger()}},Ops.IfTrueThen.prototype=new Op,Ops.IfBetweenThen=function(){Op.apply(this,arguments);var e=this;this.name="if between then",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.number=this.addInPort(new Port(this,"number")),this.number.val=0,this.min=this.addInPort(new Port(this,"min")),this.min.val=0,this.max=this.addInPort(new Port(this,"max")),this.max.val=1,this.triggerThen=this.addOutPort(new Port(this,"then",OP_PORT_TYPE_FUNCTION)),this.triggerElse=this.addOutPort(new Port(this,"else",OP_PORT_TYPE_FUNCTION)),this.exe.onTriggered=function(){e.number.val>=e.min.val&&e.number.val<e.max.val?e.triggerThen.trigger():e.triggerElse.trigger()}},Ops.IfBetweenThen.prototype=new Op,Ops.ToggleBool=function(){Op.apply(this,arguments);this.name="ToggleBool",this.bool=this.addInPort(new Port(this,"boolean")),this.bool.val=!1,this.boolOut=this.addOutPort(new Port(this,"result")),this.boolOut.val=!0,this.bool.onValueChanged=function(){this.boolOut=!this.bool.val}},Ops.ToggleBool.prototype=new Op,Ops.Group=function(){Op.apply(this,arguments);var e=this;this.name="group",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.triggers=[];for(var t=0;10>t;t++)this.triggers.push(this.addOutPort(new Port(this,"trigger "+t,OP_PORT_TYPE_FUNCTION)));this.exe.onTriggered=function(){for(var t in e.triggers)e.triggers[t].trigger()},this.uiAttribs.warning='"group" is deprecated, please use "sequence now"'},Ops.Group.prototype=new Op,Ops.Sequence=function(){Op.apply(this,arguments);var e=this;this.name="sequence",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.triggers=[];for(var t=0;10>t;t++)this.triggers.push(this.addOutPort(new Port(this,"trigger "+t,OP_PORT_TYPE_FUNCTION)));this.exe.onTriggered=function(){for(var t=0;t<e.triggers.length;t++)e.triggers[t].trigger()}},Ops.Sequence.prototype=new Op,Ops.TimedSequence=function(){Op.apply(this,arguments);var e=this;this.name="TimedSequence",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.current=this.addInPort(new Port(this,"current",OP_PORT_TYPE_VALUE)),this.current.val=0,this.overwriteTime=this.addInPort(new Port(this,"overwriteTime",OP_PORT_TYPE_VALUE,{display:"bool"})),this.overwriteTime.val=!1,this.ignoreInSubPatch=this.addInPort(new Port(this,"ignoreInSubPatch",OP_PORT_TYPE_VALUE,{display:"bool"})),this.ignoreInSubPatch.val=!1,this.triggerAlways=this.addOutPort(new Port(this,"triggerAlways",OP_PORT_TYPE_FUNCTION)),this.currentKeyTime=this.addOutPort(new Port(this,"currentKeyTime",OP_PORT_TYPE_VALUE));for(var t=[],r=0;30>r;r++)t.push(this.addOutPort(new Port(this,"trigger "+r,OP_PORT_TYPE_FUNCTION)));this.onLoaded=function(){},this.exe.onTriggered=function(r){if(e.current.anim){var n=r;void 0===r&&(n=e.current.parent.patch.timer.getTime()),e.currentKeyTime.val=n-e.current.anim.getKey(n).time,e.current.isAnimated()&&e.overwriteTime.val&&(e.current.parent.patch.timer.overwriteTime=e.currentKeyTime.val)}if(e.patch.gui&&e.ignoreInSubPatch.val)for(var i=0;i<t.length;i++)for(var a=0;a<t[i].links.length;a++)if(t[i].links[a]&&t[i].links[a].portIn.parent.patchId&&gui.patch().getCurrentSubPatch()==t[i].links[a].portIn.parent.patchId.val)return e.patch.timer.overwriteTime=-1,void t[i].trigger();var o=Math.round(e.current.val-.5);o>=0&&o<t.length&&t[o].trigger(),e.patch.timer.overwriteTime=-1,e.triggerAlways.trigger()}},Ops.TimedSequence.prototype=new Op,Ops.Interval=function(){Op.apply(this,arguments),this.name="Interval",this.timeOutId=-1,this.interval=this.addInPort(new Port(this,"interval")),this.interval.val=1e3,this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.exec=function(){if(-1==this.timeOutId){var e=this;this.timeOutId=setTimeout(function(){e.timeOutId=-1,e.trigger.trigger(),e.exec()},this.interval.val)}},this.exec()},Ops.Interval.prototype=new Op,Ops.Anim={},Ops.Anim.SinusAnim=function(){Op.apply(this,arguments),this.name="SinusAnim",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result")),this.phase=this.addInPort(new Port(this,"phase",OP_PORT_TYPE_VALUE)),this.mul=this.addInPort(new Port(this,"frequency",OP_PORT_TYPE_VALUE)),this.amplitude=this.addInPort(new Port(this,"amplitude",OP_PORT_TYPE_VALUE));var e=this;this.exe.onTriggered=function(){e.result.val=e.amplitude.val*Math.sin(Date.now()/1e3*e.mul.val+parseFloat(e.phase.val))},this.mul.val=1,this.amplitude.val=1,this.phase.val=1,this.exe.onTriggered()},Ops.Anim.SinusAnim.prototype=new Op,Ops.Anim.RelativeTime=function(){Op.apply(this,arguments),this.name="RelativeTime",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result"));var e=this,t=Date.now()/1e3;this.exe.onTriggered=function(){e.result.val=Date.now()/1e3-t},this.exe.onTriggered()},Ops.Anim.RelativeTime.prototype=new Op,Ops.Anim.Frequency=function(){Op.apply(this,arguments),this.name="Frequency",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.frequency=this.addInPort(new Port(this,"frequency",OP_PORT_TYPE_VALUE)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION));var e=this,t=0;this.exe.onTriggered=function(){Date.now()-t>e.frequency.val&&(t=Date.now(),e.trigger.trigger())}},Ops.Anim.Frequency.prototype=new Op,Ops.Anim.TimeDiff=function(){Op.apply(this,arguments),this.name="TimeDiff",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result"));var e=this,t=Date.now();this.exe.onTriggered=function(){e.result.val=Date.now()-t,t=Date.now(),e.trigger.trigger()},this.exe.onTriggered()},Ops.Anim.TimeDiff.prototype=new Op;var cableVars={};Ops.Anim.Variable=function(){function e(){cableVars[r.varName.val]=r.val.val,r.result.val=r.val.val}function t(){r.val.val=cableVars[r.varName.val]}var r=this;Op.apply(this,arguments),this.name="Variable",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.varName=this.addInPort(new Port(this,"name")),this.val=this.addInPort(new Port(this,"value")),this.result=this.addOutPort(new Port(this,"result")),this.val.onValueChanged=e,this.varName.onValueChanged=e,this.exe.onTriggered=t},Ops.Anim.Variable.prototype=new Op,Ops.String=Ops.String||{},Ops.String.concat=function(){Op.apply(this,arguments);var e=this;this.name="concat",this.result=this.addOutPort(new Port(this,"result")),this.string1=this.addInPort(new Port(this,"string1")),this.string2=this.addInPort(new Port(this,"string2")),this.exec=function(){e.result.val=e.string1.val+e.string2.val},this.string1.onValueChanged=this.exec,this.string2.onValueChanged=this.exec,this.string1.val="wurst",this.string2.val="tuete"},Ops.String.concat.prototype=new Op,Ops.LoadingStatus=function(){function e(){
o.length>0&&n==i&&(n++,a=o[n]),t.preRenderStatus.val=n/o.length,0===o.length||i==o.length-1?setTimeout(function(){console.log("finished prerendering"),t.onAnimFrame=function(){},r=!0,t.patch.timer.play(),t.patch.timer.setTime(0),CGL.decrementLoadingAssets()},80):setTimeout(e,30)}Op.apply(this,arguments);var t=this;this.name="loadingStatus",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.finished=this.addOutPort(new Port(this,"finished",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"status",OP_PORT_TYPE_VALUE)),this.preRenderStatus=this.addOutPort(new Port(this,"preRenderStatus",OP_PORT_TYPE_VALUE)),this.preRenderTimeFrames=this.addInPort(new Port(this,"preRenderTimes",OP_PORT_TYPE_VALUE)),this.preRenderStatus.val=0,this.numAssets=this.addOutPort(new Port(this,"numAssets",OP_PORT_TYPE_VALUE)),this.loading=this.addOutPort(new Port(this,"loading",OP_PORT_TYPE_FUNCTION));var r=!1,n=0,i=0,a=0,o=[],l=vec3.create();vec3.set(l,0,0,-2);var s=function(e){t.patch.timer.setTime(a),t.finished.trigger(),cgl.gl.flush(),Ops.Gl.Renderer.renderStart(l),cgl.gl.clearColor(0,0,0,1),cgl.gl.clear(cgl.gl.COLOR_BUFFER_BIT|cgl.gl.DEPTH_BUFFER_BIT),t.loading.trigger(),console.log("pre anim"),Ops.Gl.Renderer.renderEnd(),i=n};this.onAnimFrame=function(){},this.exe.onTriggered=function(){if(t.result.val=CGL.getLoadingStatus(),t.numAssets.val=CGL.numMaxLoadingAssets,r)t.finished.trigger();else if(t.loading.trigger(),t.patch.timer.pause(),t.result.val>=1||0===CGL.numMaxLoadingAssets){CGL.incrementLoadingAssets();var n=0;for(n=0;n<t.patch.ops.length;n++)t.patch.ops[n].onLoaded&&t.patch.ops[n].onLoaded();if(t.preRenderTimeFrames.isAnimated())for(n=0;n<t.preRenderTimeFrames.anim.keys.length;n++)o.push(t.preRenderTimeFrames.anim.keys[n].time);o.push(0),this.onAnimFrame!=s&&(t.onAnimFrame=s),e()}}},Ops.LoadingStatus.prototype=new Op,Ops.TriggerCounter=function(){Op.apply(this,arguments);var e=this;this.name="TriggerCounter",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.reset=this.addInPort(new Port(this,"reset",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.num=this.addOutPort(new Port(this,"timesTriggered",OP_PORT_TYPE_VALUE));var t=0;this.exe.onTriggered=function(){t++,e.num.val=t,e.trigger.trigger()},this.reset.onTriggered=function(){t=0,e.num.val=t}},Ops.TriggerCounter.prototype=new Op,Ops.Json=Ops.Json||{},Ops.Json.jsonValue=function(){var e=this;Op.apply(this,arguments),this.name="jsonValue",this.data=this.addInPort(new Port(this,"data",OP_PORT_TYPE_TEXTURE)),this.key=this.addInPort(new Port(this,"key")),this.result=this.addOutPort(new Port(this,"result")),this.data.onValueChanged=function(){e.data.val&&e.data.val.hasOwnProperty(e.key.val)&&(e.result.val=e.data.val[e.key.val])}},Ops.Json.jsonValue.prototype=new Op,Ops.Math=Ops.Math||{},Ops.Math.Random=function(){var e=this;Op.apply(this,arguments),this.name="random",this.exe=this.addInPort(new Port(this,"exe",OP_PORT_TYPE_FUNCTION)),this.result=this.addOutPort(new Port(this,"result")),this.minusPlusOne=this.addInPort(new Port(this,"0 to x / -x to x ",OP_PORT_TYPE_VALUE,{display:"bool"})),this.max=this.addInPort(new Port(this,"max")),this.exe.onTriggered=function(){e.result.val=e.minusPlusOne.val?Math.random()*e.max.val*2-e.max.val/2:Math.random()*e.max.val},this.exe.onTriggered(),this.max.val=1},Ops.Math.Random.prototype=new Op,Ops.Math.Clamp=function(){function e(){t.updateAnims(),t.result.val=Math.min(Math.max(t.val.val,t.min.val),t.max.val)}var t=this;Op.apply(this,arguments),this.name="Clamp",this.val=this.addInPort(new Port(this,"val")),this.min=this.addInPort(new Port(this,"min")),this.max=this.addInPort(new Port(this,"max")),this.result=this.addOutPort(new Port(this,"result")),this.min.val=0,this.max.val=1,this.val.onValueChanged=e,this.min.onValueChanged=e,this.max.onValueChanged=e,this.val.val=.5},Ops.Math.Clamp.prototype=new Op,Ops.Math.SmoothStep=function(){function e(){t.updateAnims();var e=Math.max(0,Math.min(1,(t.val.val-t.min.val)/(t.max.val-t.min.val)));t.result.val=e*e*(3-2*e)}var t=this;Op.apply(this,arguments),this.name="SmoothStep",this.val=this.addInPort(new Port(this,"val")),this.min=this.addInPort(new Port(this,"min")),this.max=this.addInPort(new Port(this,"max")),this.result=this.addOutPort(new Port(this,"result")),this.min.val=0,this.max.val=1,this.val.onValueChanged=e,this.min.onValueChanged=e,this.max.onValueChanged=e,this.val.val=.5},Ops.Math.SmoothStep.prototype=new Op,Ops.Math.MapRange=function(){Op.apply(this,arguments);var e=this;this.name="map value range",this.result=this.addOutPort(new Port(this,"result")),this.v=this.addInPort(new Port(this,"value")),this.old_min=this.addInPort(new Port(this,"old min")),this.old_max=this.addInPort(new Port(this,"old max")),this.new_min=this.addInPort(new Port(this,"new min")),this.new_max=this.addInPort(new Port(this,"new max")),this.exec=function(){if(e.updateAnims(),e.v.val>e.old_max.val)return void(e.result.val=e.new_max.val);if(e.v.val<e.old_min.val)return void(e.result.val=e.new_min.val);var t=parseFloat(e.new_min.val),r=parseFloat(e.new_max.val),n=parseFloat(e.old_min.val),i=parseFloat(e.old_max.val),a=parseFloat(e.v.val),o=!1,l=Math.min(n,i),s=Math.max(n,i);l!=n&&(o=!0);var d=!1,h=Math.min(t,r),u=Math.max(t,r);h!=t&&(d=!0);var g=0;g=o?(s-a)*(u-h)/(s-l):(a-l)*(u-h)/(s-l),e.result.val=d?u-g:g+h},this.v.val=0,this.old_min.val=-1,this.old_max.val=1,this.new_min.val=0,this.new_max.val=1,this.v.onValueChanged=this.exec,this.old_min.onValueChanged=this.exec,this.old_max.onValueChanged=this.exec,this.new_min.onValueChanged=this.exec,this.new_max.onValueChanged=this.exec,this.exec()},Ops.Math.MapRange.prototype=new Op,Ops.Math.Abs=function(){Op.apply(this,arguments);var e=this;this.name="abs",this.number=this.addInPort(new Port(this,"number")),this.result=this.addOutPort(new Port(this,"result")),this.number.onValueChanged=function(){e.result.val=Math.abs(e.number.val)}},Ops.Math.Abs.prototype=new Op,Ops.Math.Sin=function(){Op.apply(this,arguments);var e=this;this.name="Sinus",this.number=this.addInPort(new Port(this,"number")),this.result=this.addOutPort(new Port(this,"result")),this.number.onValueChanged=function(){e.result.val=Math.sin(e.number.val)}},Ops.Math.Sin.prototype=new Op,Ops.Math.SmoothStep=function(){function e(){r=t.min.val,n=t.max.val}Op.apply(this,arguments);var t=this;this.name="SmoothStep",this.result=this.addOutPort(new Port(this,"result")),this.number=this.addInPort(new Port(this,"number")),this.min=this.addInPort(new Port(this,"min")),this.max=this.addInPort(new Port(this,"max"));var r=0,n=1;this.exec=function(){var e=t.number.val,i=Math.max(0,Math.min(1,(e-r)/(n-r)));t.result.val=i*i*(3-2*i)},this.min.val=0,this.max.val=1,this.number.val=0,this.number.onValueChanged=this.exec,this.max.onValueChanged=e,this.min.onValueChanged=e,e()},Ops.Math.SmoothStep.prototype=new Op,Ops.Math.Sum=function(){Op.apply(this,arguments);var e=this;this.name="sum",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=parseFloat(e.number1.val)+parseFloat(e.number2.val)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number1.val=1,this.number2.val=1},Ops.Math.Sum.prototype=new Op,Ops.Math.Subtract=function(){Op.apply(this,arguments);var e=this;this.name="subtract",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=parseFloat(e.number1.val)-parseFloat(e.number2.val)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number1.val=1,this.number2.val=1},Ops.Math.Subtract.prototype=new Op,Ops.Math.Multiply=function(){Op.apply(this,arguments);var e=this;this.name="multiply",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val*e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number1.val=1,this.number2.val=2},Ops.Math.Multiply.prototype=new Op,Ops.Math.Modulo=function(){Op.apply(this,arguments);var e=this;this.name="Modulo",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val%e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number1.val=1,this.number2.val=2},Ops.Math.Modulo.prototype=new Op,Ops.Math.Divide=function(){Op.apply(this,arguments);var e=this;this.name="Divide",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val/e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Divide.prototype=new Op,Ops.Math.Compare={},Ops.Math.Compare.IsEven=function(){Op.apply(this,arguments);var e=this;this.name="isEven",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.exec=function(){e.result.val=!(1&e.number1.val)},this.number1.onValueChanged=this.exec},Ops.Math.Compare.IsEven.prototype=new Op,Ops.Math.Compare.Greater=function(){Op.apply(this,arguments);var e=this;this.name="Greater",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val>e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Greater.prototype=new Op,Ops.Math.Compare.Between=function(){Op.apply(this,arguments);var e=this;this.name="Between",this.result=this.addOutPort(new Port(this,"result")),this.number=this.addInPort(new Port(this,"value")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.number.val=2,this.number1.val=1,this.number2.val=3,this.exec=function(){e.updateAnims(),e.result.val=e.number.val>Math.min(e.number1.val,e.number2.val)&&e.number.val<Math.max(e.number1.val,e.number2.val)},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec,this.number.onValueChanged=this.exec},Ops.Math.Compare.Between.prototype=new Op,Ops.Math.Compare.Lesser=function(){Op.apply(this,arguments);var e=this;this.name="Lesser",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val<e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Lesser.prototype=new Op,Ops.Math.Compare.Equals=function(){Op.apply(this,arguments);var e=this;this.name="Equals",this.result=this.addOutPort(new Port(this,"result")),this.number1=this.addInPort(new Port(this,"number1")),this.number2=this.addInPort(new Port(this,"number2")),this.exec=function(){e.updateAnims(),e.result.val=e.number1.val==e.number2.val},this.number1.onValueChanged=this.exec,this.number2.onValueChanged=this.exec},Ops.Math.Compare.Equals.prototype=new Op,Ops.Net=Ops.Net||{},Ops.Net.Websocket=function(){function e(){r.connected.val===!1&&t(),i=setTimeout(e,1e3)}function t(){if(r.connected.val!==!0||a!=r.url.val){r.connected.val===!0&&n.close(),window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket||console.error("Sorry, but your browser doesn't support WebSockets.");try{null!=n&&n.close(),n=new WebSocket(r.url.val)}catch(e){console.log("could not connect to",r.url.val)}n.onerror=function(e){r.connected.val=!1},n.onclose=function(e){r.connected.val=!1},n.onopen=function(e){r.connected.val=!0,a=r.url.val},n.onmessage=function(e){try{var t=JSON.parse(e.data);r.result.val=t}catch(n){return void console.log("This doesn't look like a valid JSON: ",e.data)}}}}var r=this;Op.apply(this,arguments),this.name="Websocket",this.url=this.addInPort(new Port(this,"url")),this.result=this.addOutPort(new Port(this,"result",OP_PORT_TYPE_OBJECT)),this.connected=this.addOutPort(new Port(this,"connected"));var n=null,i=null,a="";this.url.onValueChanged=t,i=setTimeout(e,1e3),this.url.val="ws://127.0.0.1:1337"},Ops.Net.Websocket.prototype=new Op,Ops=Ops||{},Ops.Ui=Ops.Ui||{},Ops.Ui.Comment=function(){Op.apply(this,arguments),this.name="Comment",this.title=this.addInPort(new Port(this,"title")),this.text=this.addInPort(new Port(this,"text"))},Ops.Ui.Comment.prototype=new Op,Ops.Ui.Patch=function(){var e=this;Op.apply(this,arguments),this.name="Patch",this.patchId=this.addInPort(new Port(this,"patchId",OP_PORT_TYPE_VALUE,{display:"readonly"}));var t=function(){for(var t in e.portsIn){if(e.portsIn[t].type==OP_PORT_TYPE_DYNAMIC)return!0;if("dyn"==e.portsIn[t].getName())return!0}return!1},r=function(t){for(var r in this.portsIn)if(this.portsIn[r].type==OP_PORT_TYPE_DYNAMIC)return this.portsIn[r].name=t,this.portsIn[r];var n=e.addInPort(new Port(e,t,OP_PORT_TYPE_DYNAMIC));return n.shouldLink=e.shouldLink,n};this.getPort=function(t){for(var n in e.portsIn)if(e.portsIn[n].getName()==t)return e.portsIn[n];var i=r(t);return i};var n=function(){var t=e.patch.getSubPatchOp(e.patchId.val,"Ops.Ui.PatchInput");return t||(console.log("no patchinput!"),e.patch.addOp("Ops.Ui.PatchInput",{subPatch:e.patchId.val}),t=e.patch.getSubPatchOp(e.patchId.val,"Ops.Ui.PatchInput"),t||console.warn("no patchinput2!")),t};this.shouldLink=function(i,a){if(i.type!=OP_PORT_TYPE_DYNAMIC&&a.type!=OP_PORT_TYPE_DYNAMIC)return!0;var o=a,l=i;i.type==OP_PORT_TYPE_DYNAMIC&&(o=i,l=a),o.type=l.type,o.name="in_"+l.getName();var s=n(),d=s.addOutPort(new Port(e,"out_"+l.getName(),o.type));return o.type==OP_PORT_TYPE_FUNCTION?(o.onTriggered=function(){d.trigger()},o.onTriggered()):(o.onValueChanged=function(){d.val=o.val},o.onValueChanged()),CABLES.UI&&gui.patch().updateSubPatches(),t()||r("dyn"),!0},this.patchId.onValueChanged=function(){Ops.Ui.Patch.maxPatchId=Math.max(Ops.Ui.Patch.maxPatchId,e.patchId.val)},this.patchId.val=Ops.Ui.Patch.maxPatchId+1,this.onCreate=function(){t()||r("dyn"),n(),CABLES.UI&&gui.patch().updateSubPatches()}},Ops.Ui.Patch.maxPatchId=0,Ops.Ui.Patch.prototype=new Op,Ops.Ui.PatchInput=function(){var e=this;Op.apply(this,arguments),this.name="PatchInput",this.getPatchOp=function(){for(var t in e.patch.ops)if(e.patch.ops[t].patchId&&e.patch.ops[t].patchId.val==e.uiAttribs.subPatch)return e.patch.ops[t];console.log("NOT FOUND PATCHOP")}},Ops.Ui.PatchInput.prototype=new Op,Ops.Ui.PatchOutput=function(){Op.apply(this,arguments),this.name="PatchOutput",this.patchOutput=this.addInPort(new Port(this,"out"))},Ops.Ui.PatchOutput.prototype=new Op,Ops.Gl.Matrix.WASDCamera=function(){function e(){var e=0,t=0,r=0,n=0,i=0;if(p&&(n=Math.cos(l*o.rotX.val),e+=g*Math.sin(l*o.rotY.val)*n,t+=g*Math.sin(l*o.rotX.val)*-1,i=Math.cos(l*o.rotX.val),r+=g*Math.cos(l*o.rotY.val)*-1*i),v&&(n=Math.cos(l*o.rotX.val),e+=g*Math.sin(l*o.rotY.val)*-1*n,t+=g*Math.sin(l*o.rotX.val),i=Math.cos(l*o.rotX.val),r+=g*Math.cos(l*o.rotY.val)*i),f){var a=l*o.rotY.val;e+=-g*Math.cos(a),r+=-g*Math.sin(a)}if(m){var a=l*o.rotY.val;e+=g*Math.cos(a),r+=g*Math.sin(a)}d=e,h=t,u=r,d>g&&(d=g),-g>d&&(d=-g),h>g&&(h=g),-g>h&&(h=-g),u>g&&(u=g),-g>u&&(u=-g)}function t(e){var t=.1;o.rotX.val+=e.movementY*t,o.rotY.val+=e.movementX*t,o.rotX.val<-90&&(o.rotX.val=-90),o.rotX.val>90&&(o.rotX.val=90),o.rotY.val<-180&&(o.rotY.val+=360),o.rotY.val>180&&(o.rotY.val-=360)}function r(e){document.pointerLockElement===c||document.mozPointerLockElement===c||document.webkitPointerLockElement===c?(document.addEventListener("mousemove",t,!1),document.addEventListener("keydown",i,!1),document.addEventListener("keyup",a,!1),console.log("lock start"),o.isLocked.val=!0):(document.removeEventListener("mousemove",t,!1),document.removeEventListener("keydown",i,!1),document.removeEventListener("keyup",a,!1),o.isLocked.val=!1,p=!1,f=!1,v=!1,m=!1,console.log("lock exit"))}function n(){window.performance.now()-P;o.posX.val+=d,o.posY.val+=h,o.posZ.val+=u,P=window.performance.now()}function i(e){switch(e.which){case 87:p=!0;break;case 65:f=!0;break;case 83:v=!0;break;case 68:m=!0;break;default:console.log("key:",e.which)}}function a(e){switch(console.log("key"),e.which){case 87:p=!1;break;case 65:f=!1;break;case 83:v=!1;break;case 68:m=!1}}Op.apply(this,arguments);var o=this,l=3.14159/180;this.name="WASDCamera",this.render=this.addInPort(new Port(this,"render",OP_PORT_TYPE_FUNCTION)),this.trigger=this.addOutPort(new Port(this,"trigger",OP_PORT_TYPE_FUNCTION)),this.isLocked=this.addOutPort(new Port(this,"isLocked",OP_PORT_TYPE_VALUE)),this.isLocked.val=!1;var s=vec3.create(),d=0,h=0,u=0,g=.5;this.posX=this.addInPort(new Port(this,"posX",OP_PORT_TYPE_VALUE)),this.posY=this.addInPort(new Port(this,"posY",OP_PORT_TYPE_VALUE)),this.posZ=this.addInPort(new Port(this,"posZ",OP_PORT_TYPE_VALUE)),this.rotX=this.addInPort(new Port(this,"rotX",OP_PORT_TYPE_VALUE)),this.rotY=this.addInPort(new Port(this,"rotY",OP_PORT_TYPE_VALUE)),this.outPosX=this.addOutPort(new Port(this,"posX",OP_PORT_TYPE_VALUE)),this.outPosY=this.addOutPort(new Port(this,"posY",OP_PORT_TYPE_VALUE)),this.outPosZ=this.addOutPort(new Port(this,"posZ",OP_PORT_TYPE_VALUE)),o.outPosX.val=-o.posX.val,o.outPosY.val=-o.posY.val,o.outPosZ.val=-o.posZ.val;mat4.create();this.render.onTriggered=function(){e(),n(),(0!==d||0!==h||0!==u)&&(o.outPosX.val=-o.posX.val,o.outPosY.val=-o.posY.val,o.outPosZ.val=-o.posZ.val),cgl.pushMvMatrix(),vec3.set(s,-o.posX.val,-o.posY.val,-o.posZ.val),mat4.rotateX(cgl.mvMatrix,cgl.mvMatrix,l*o.rotX.val),mat4.rotateY(cgl.mvMatrix,cgl.mvMatrix,l*o.rotY.val),mat4.translate(cgl.mvMatrix,cgl.mvMatrix,s),o.trigger.trigger(),cgl.popMvMatrix()};var c=document.getElementById("glcanvas");document.addEventListener("pointerlockchange",r,!1),document.addEventListener("mozpointerlockchange",r,!1),document.addEventListener("webkitpointerlockchange",r,!1),document.getElementById("glcanvas").addEventListener("mousedown",function(){document.addEventListener("mousemove",t,!1),c.requestPointerLock=c.requestPointerLock||c.mozRequestPointerLock||c.webkitRequestPointerLock,c.requestPointerLock()});var P=0,p=!1,f=!1,v=!1,m=!1},Ops.Gl.Matrix.WASDCamera.prototype=new Op;
//# sourceMappingURL=cables.ops.min.js.map